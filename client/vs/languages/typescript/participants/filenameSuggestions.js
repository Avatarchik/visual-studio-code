/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";define("vs/languages/typescript/participants/filenameSuggestions",["require","exports","vs/base/strings","vs/base/paths","vs/base/collections","vs/base/lib/winjs.base","vs/base/network","vs/languages/typescript/lib/typescriptServices","vs/languages/typescript/project/typescriptProject"],function(e,t,r,n,s,a,o,i,l){var c=function(){function e(e,t,r){this._requestService=e,this._amd=t,this.basepath=r,"/"===this.basepath&&(this.basepath=null)}return e.prototype.makeModulePath=function(e,t,r){return e?this._toRequirePath(t,r):this._toReferencesPath(t,r)},e.prototype._toRequirePath=function(e,t){var s,a=n.dirname(t);if(this._amd&&this.basepath){var i=this._requestService.getPath("root",o.URL.fromValue(e));s=i.substr(this.basepath.length),s=r.ltrim(s,"/")}else s=n.join(n.relative(a,n.dirname(e)),n.basename(e)),r.startsWith(s,"..")||(s="./"+s);return s=r.rtrim(s,".ts"),s=r.rtrim(s,".js")},e.prototype._toReferencesPath=function(e,t){var r=n.dirname(t);return n.join(n.relative(r,n.dirname(e)),n.basename(e))},e}();t.PathMaker=c;var u=function(){function e(e){this._resourceServices=e.resourceService,this._requestService=e.requestService}return e.prototype.suggest=function(e,t,o){if(!(o&&o.syntaxTree&&o.project instanceof l.TypeScriptProject))return a.TPromise.as(null);var i=o.syntaxTree,u=this._findCurrentWord(e,t,i);if(!u)return a.TPromise.as(null);var d=o.project,m=d.compileConfiguration(),p=new c(this._requestService,r.equalsIgnoreCase(m.module,"amd"),m.baseUrl),h=e.toString(),f=this._requestService.getRequestUrl("root",r.empty,!0),g=this._requestService.getRequestUrl("root",m.scope,!0),v=/^['"]/.test(u.wordUntilPosition)?u.wordUntilPosition[0]:'"',b={currentWord:u.wordUntilPosition,suggestions:[]},y=Object.create(null);return d.contentResolver().accept(function(t){if(u.external&&r.endsWith(t.path,".d.ts"))return!0;var s=n.join(f,t.path);if(s===e.toString()||!n.isEqualOrParent(s,g))return!0;if(y[s])return!0;var a=p.makeModulePath(u.external,s,h);return y[s]={label:r.format("{0}{1}{0}",v,a),codeSnippet:r.rtrim(r.format("{0}{1}{0}",v,a),u.wordAfterPosition),documentationLabel:"."!==n.dirname(t.path)?r.format("{0} - {1}",n.basename(t.path),n.dirname(t.path)):t.path,type:"reference"},!0}).then(function(){return b.suggestions=s.values(y),b})},e.prototype._findCurrentWord=function(t,r,n){var s=this._resourceServices.get(t),a=s.getOffsetFromPosition(r),o=i.findTokenOnLeftOfPosition(n,a),l=n.referencedFiles.length;if(l>0&&n.referencedFiles[0].pos<=a&&a<=n.referencedFiles[l-1].end){var c=s.getLineContent(r.lineNumber),u=s.getOffsetFromPosition({lineNumber:r.lineNumber,column:1}),m=e._TrippleSlashReference.exec(c);if(m)return{wordUntilPosition:m[2].substring(0,a-(u+m[1].length)),wordAfterPosition:m[2].substring(a-(u+m[1].length)),external:!1}}else{if(d.isTokenPath(o,i.SyntaxKind.StringLiteral,i.SyntaxKind.ExternalModuleReference))return{wordUntilPosition:i.getTextOfNode(o).substr(0,a-o.getStart()),wordAfterPosition:i.getTextOfNode(o).substr(a-o.getStart()),external:!0};if(d.isTokenPath(o,i.SyntaxKind.StringLiteral,i.SyntaxKind.ArrayLiteralExpression,i.SyntaxKind.CallExpression)){var p=d.parent(o,2);if("require"===i.getTextOfNode(p.expression))return{wordUntilPosition:i.getTextOfNode(o).substr(0,a-o.getStart()),wordAfterPosition:i.getTextOfNode(o).substr(a-o.getStart()),external:!0}}else if(d.isTokenPath(o,i.SyntaxKind.StringLiteral,i.SyntaxKind.ArrayLiteralExpression,i.SyntaxKind.CallExpression)){var p=d.parent(o,2);if("define"===i.getTextOfNode(p.expression))return{wordUntilPosition:i.getTextOfNode(o).substr(0,a-o.getStart()),wordAfterPosition:i.getTextOfNode(o).substr(a-o.getStart()),external:!0}}}},e._TrippleSlashReference=/^(\/\/\/\s*<reference\s+path=)([^\s>]+)/i,e}();t.FilenameSuggestions=u;var d;!function(e){function t(e,t){for(;t-->0&&e;)e=e.parent;return e}function r(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(;t.length>0&&e;){var n=t.shift();if(n!==e.kind)return!1;e=e.parent}return!0}e.parent=t,e.isTokenPath=r}(d||(d={}))});