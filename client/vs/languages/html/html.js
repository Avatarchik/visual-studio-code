/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";var __extends=this.__extends||function(e,r){function s(){this.constructor=e}for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);s.prototype=r.prototype,e.prototype=new s};define("vs/languages/html/html",["require","exports","vs/editor/modes/modes","vs/editor/modes/modesExtensions","vs/editor/modes/supports","vs/base/arrays","vs/platform/platform","vs/platform/services","vs/base/lib/winjs.base","vs/platform/thread/attribute"],function(e,r,s,n,o,t,a,i,l,c){function d(e){return-1!==t.binarySearch(u,e,function(e,r){return e.localeCompare(r)})}!function(e){e[e.Content=0]="Content",e[e.OpeningStartTag=1]="OpeningStartTag",e[e.OpeningEndTag=2]="OpeningEndTag",e[e.WithinDoctype=3]="WithinDoctype",e[e.WithinTag=4]="WithinTag",e[e.WithinComment=5]="WithinComment",e[e.WithinEmbeddedContent=6]="WithinEmbeddedContent",e[e.AttributeName=7]="AttributeName",e[e.AttributeValue=8]="AttributeValue"}(r.States||(r.States={}));var m=r.States,u=["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"],h=["script","style"],b=function(e){function r(r,s,n,o,t,a,i){e.call(this,r),this.kind=s,this.lastTagName=n,this.lastAttributeName=o,this.embeddedContentType=t,this.attributeValueQuote=a,this.attributeValue=i}return __extends(r,e),r.escapeTagName=function(e){return"tag.html.tag-"+e.replace(/:/g,"-")},r.prototype.makeClone=function(){return new r(this.getMode(),this.kind,this.lastTagName,this.lastAttributeName,this.embeddedContentType,this.attributeValueQuote,this.attributeValue)},r.prototype.equals=function(s){return s instanceof r?e.prototype.equals.call(this,s)&&this.kind===s.kind&&this.lastTagName===s.lastTagName&&this.lastAttributeName===s.lastAttributeName&&this.embeddedContentType===s.embeddedContentType&&this.attributeValueQuote===s.attributeValueQuote&&this.attributeValue===s.attributeValue:!1},r.prototype.nextName=function(e){return e.advanceIfRegExp(/^[_:\w][_:\w-.\d]*/).toLowerCase()},r.prototype.tokenize=function(e){switch(this.kind){case m.WithinComment:if(e.advanceUntilString2("-->",!1))return{type:"comment.html.content"};if(e.advanceIfString2("-->"))return this.kind=m.Content,{type:"comment.html",bracket:s.Bracket.Close};break;case m.WithinDoctype:if(e.advanceUntilString2(">",!1))return{type:"metatag.content.html"};if(e.advanceIfString2(">"))return this.kind=m.Content,{type:"metatag.html",bracket:s.Bracket.Close};break;case m.Content:if(e.advanceIfCharCode2("<".charCodeAt(0))){if(!e.eos()&&"!"===e.peek()){if(e.advanceIfString2("!--"))return this.kind=m.WithinComment,{type:"comment.html",bracket:s.Bracket.Open};if(e.advanceIfStringCaseInsensitive2("!DOCTYPE"))return this.kind=m.WithinDoctype,{type:"metatag.html",bracket:s.Bracket.Open}}return e.advanceIfCharCode2("/".charCodeAt(0))?(this.kind=m.OpeningEndTag,{type:"delimiter.end.html",bracket:s.Bracket.Open}):(this.kind=m.OpeningStartTag,{type:"delimiter.start.html",bracket:s.Bracket.Open})}break;case m.OpeningEndTag:var n=this.nextName(e);return n.length>0?{type:r.escapeTagName(n),bracket:d(n)?-1:s.Bracket.Close}:e.advanceIfString2(">")?(this.kind=m.Content,{type:"delimiter.end.html",bracket:s.Bracket.Close}):(e.advanceUntilString2(">",!1),{type:""});case m.OpeningStartTag:if(this.lastTagName=this.nextName(e),this.lastTagName.length>0)return this.lastAttributeName=null,("script"===this.lastTagName||"style"===this.lastTagName)&&(this.lastAttributeName=null,this.embeddedContentType=null),this.kind=m.WithinTag,{type:r.escapeTagName(this.lastTagName),bracket:d(this.lastTagName)?-1:s.Bracket.Open};break;case m.WithinTag:if(e.skipWhitespace2()||e.eos())return{type:""};var o=this.nextName(e);return o.length>0?(this.lastAttributeName=o,this.kind=m.AttributeName,{type:"attribute.name.html"}):e.advanceIfString2("/>")?(this.kind=m.Content,{type:"delimiter.start.html",bracket:s.Bracket.Close}):e.advanceIfCharCode2(">".charCodeAt(0))?-1!==h.indexOf(this.lastTagName)?(this.kind=m.WithinEmbeddedContent,{type:"delimiter.start.html",bracket:s.Bracket.Close}):(this.kind=m.Content,{type:"delimiter.start.html",bracket:s.Bracket.Close}):(e.next2(),{type:""});case m.AttributeName:return e.skipWhitespace2()||e.eos()?{type:""}:e.advanceIfCharCode2("=".charCodeAt(0))?(this.kind=m.AttributeValue,{type:"delimiter.assign.html"}):(this.kind=m.WithinTag,this.tokenize(e));case m.AttributeValue:if(e.eos())return{type:""};if(e.skipWhitespace2())return'"'===this.attributeValueQuote||"'"===this.attributeValueQuote?{type:"attribute.value.html"}:{type:""};if('"'!==this.attributeValueQuote&&"'"!==this.attributeValueQuote){var t=e.peek();return"'"===t||'"'===t?(this.attributeValueQuote=t,this.attributeValue=t,e.next2(),{type:"attribute.value.html"}):(this.kind=m.WithinTag,this.tokenize(e))}if(this.attributeValue!==this.attributeValueQuote||"script"!==this.lastTagName&&"style"!==this.lastTagName||"type"!==this.lastAttributeName){if(e.advanceIfCharCode2(this.attributeValueQuote.charCodeAt(0)))this.kind=m.WithinTag,this.attributeValue="",this.attributeValueQuote="";else{var a=e.next();this.attributeValue+=a}return{type:"attribute.value.html"}}if(this.attributeValue=e.advanceUntilString(this.attributeValueQuote,!0),this.attributeValue.length>0)return this.embeddedContentType=this.unquote(this.attributeValue),this.kind=m.WithinTag,this.attributeValue="",this.attributeValueQuote="",{type:"attribute.value.html"}}return e.next2(),this.kind=m.Content,{type:""}},r.prototype.unquote=function(e){var r=0,s=e.length;return'"'===e[0]&&r++,'"'===e[s-1]&&s--,e.substring(r,s)},r}(n.AbstractState);r.State=b;var w=function(e){function r(r,s,n){var t=this;void 0===n&&(n=i.AsyncDescriptor.create("vs/languages/html/htmlWorker","HTMLWorker")),e.call(this,r,s,n),this.tokenizationSupport=new o.TokenizationSupport(this,!0),this.electricCharacterSupport=new o.BracketElectricCharacterSupport(this,{brackets:[],regexBrackets:[{tokenType:"tag.html.tag-$1",openTrigger:">",open:/<(\w[\w\d]*)(\s+.*[^\/]>|\s*>)[^<]*$/i,closeComplete:"</$1>",closeTrigger:">",close:/<\/(\w[\w\d]*)\s*>$/i}],caseInsensitive:!0,embeddedElectricCharacters:["*","}","]",")"]}),this.formattingSupport=this,this.extraInfoSupport=this,this.referenceSupport=new o.ReferenceSupport(this,{tokens:["invalid"],findReferences:function(e,r,s){return t.findReferences(e,r,s)}}),this.logicalSelectionSupport=this,this.parameterHintsSupport=new o.ParameterHintsSupport(this,{triggerCharacters:["(",","],excludeTokens:["*"],getParameterHints:function(e,r){return t.getParameterHints(e,r)}}),this.suggestSupport=new o.SuggestSupport(this,{triggerCharacters:[".",":","<",'"',"="],excludeTokens:["comment"],suggest:function(e,r){return t.suggest(e,r)}})}return __extends(r,e),r.prototype.asyncCtor=function(){var e=this;return l.Promise.join([p.getOrCreateMode("text/javascript"),p.getOrCreateMode("text/css")]).then(function(r){var s=e._getAutoClosingPairs(r);e.characterPairSupport=new o.CharacterPairSupport(e,{autoClosingPairs:s.slice(0),surroundingPairs:[{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"}]})})},r.prototype.getNonWordTokenTypes=function(){return["delimiter.html"]},r.prototype._getAutoClosingPairs=function(e){var r=this,s={'"':'"',"'":"'"};e.forEach(function(e){return r._collectAutoClosingPairs(s,e)});var n,o=[];for(n in s)o.push({open:n,close:s[n]});return o},r.prototype._collectAutoClosingPairs=function(e,r){if(r&&r.characterPairSupport){var s=r.characterPairSupport.getAutoClosingPairs();if(null!==s)for(var n=0;n<s.length;n++)e[s[n].open]=s[n].close}},r.prototype.getInitialState=function(){return new b(this,m.Content,"","","","","")},r.prototype.enterNestedMode=function(e){return e instanceof b&&e.kind===m.WithinEmbeddedContent},r.prototype.getNestedMode=function(e){var r=null,s=e,n=null;if(null!==s.embeddedContentType)p.isRegisteredMode(s.embeddedContentType)&&(r=p.getMode(s.embeddedContentType),r||(n=p.getOrCreateMode(s.embeddedContentType)));else{var o=null;o="script"===s.lastTagName?"text/javascript":"style"===s.lastTagName?"text/css":"text/plain",r=p.getMode(o)}return null===r&&(r=p.getMode("text/plain")),{mode:r,missingModePromise:n}},r.prototype.getLeavingNestedModeData=function(e,r){var s=r.lastTagName,n=new RegExp("<\\/"+s+"\\s*>","i"),o=n.exec(e);return null!==o?{nestedModeBuffer:e.substring(0,o.index),bufferAfterNestedMode:e.substring(o.index),stateAfterNestedMode:new b(this,m.Content,"","","","","")}:null},r.prototype.getWordDefinition=function(){return r.WORD_DEFINITION},r.prototype.getCommentsConfiguration=function(){return{blockCommentStartToken:"<!--",blockCommentEndToken:"-->"}},r.prototype._worker=function(r){return e.prototype._worker.call(this,r)},r.prototype.formatDocument=function(e,r){return this._worker(function(s){return s.format(e,null,r)})},r.prototype.formatRange=function(e,r,s){return this._worker(function(n){return n.format(e,r,s)})},r.prototype.computeInfo=function(e,r){return this._delegateToModeAtPosition(e,r,function(e,s){return e&&s.getMode().extraInfoSupport?s.getMode().extraInfoSupport.computeInfo(s.getAssociatedResource(),r):void 0})},r.prototype.findReferences=function(e,r,s){return this._delegateToModeAtPosition(e,r,function(e,n){return e&&n.getMode().referenceSupport?n.getMode().referenceSupport.findReferences(n.getAssociatedResource(),r,s):void 0})},r.prototype.getRangesToPosition=function(e,r){return this._delegateToModeAtPosition(e,r,function(e,s){return e&&s.getMode().logicalSelectionSupport?s.getMode().logicalSelectionSupport.getRangesToPosition(s.getAssociatedResource(),r):void 0})},r.prototype.findDeclaration=function(e,r){return this._delegateToModeAtPosition(e,r,function(e,s){return e&&s.getMode().declarationSupport?s.getMode().declarationSupport.findDeclaration(s.getAssociatedResource(),r):void 0})},r.prototype.findOccurrences=function(e,r,s){var n=this;return void 0===s&&(s=!1),this._delegateToModeAtPosition(e,r,function(o,t){return o&&t.getMode().occurrencesSupport?t.getMode().occurrencesSupport.findOccurrences(t.getAssociatedResource(),r,s):n._worker(function(n){return n.findOccurrences(e,r,s)})})},r.prototype.suggest=function(e,r){var s=this;return this._delegateToModeAtPosition(e,r,function(n,o){return n&&o.getMode().suggestSupport?o.getMode().suggestSupport.suggest(o.getAssociatedResource(),r):s._worker(function(s){return s.suggest(e,r)})})},r.prototype.findColorDeclarations=function(e){return this._delegateToAllModes(e,function(e){var r=[];return r=e.filter(function(e){return"function"==typeof e.getMode().findColorDeclarations}).map(function(e){return e.getMode().findColorDeclarations(e.getAssociatedResource())}),l.TPromise.join(r).then(function(e){var r=[];return e.forEach(function(e){return r=r.concat(e)}),r})})},r.prototype.getParameterHints=function(e,r){return this._delegateToModeAtPosition(e,r,function(e,s){return e&&s.getMode().parameterHintsSupport?s.getMode().parameterHintsSupport.getParameterHints(s.getAssociatedResource(),r):void 0})},r.WORD_DEFINITION=n.createWordRegExp("#-?%"),r.$formatDocument=c.OneWorker(r,r.prototype.formatDocument),r.$formatRange=c.OneWorker(r,r.prototype.formatRange),r.$computeInfo=c.OneWorker(r,r.prototype.computeInfo),r.$findReferences=c.OneWorker(r,r.prototype.findReferences),r.$getRangesToPosition=c.OneWorker(r,r.prototype.getRangesToPosition),r.$findDeclaration=c.OneWorker(r,r.prototype.findDeclaration),r.$findOccurrences=c.OneWorker(r,r.prototype.findOccurrences),r.$suggest=c.OneWorker(r,r.prototype.suggest),r.$findColorDeclarations=c.OneWorker(r,r.prototype.findColorDeclarations),r.$getParameterHints=c.OneWorker(r,r.prototype.getParameterHints),r}(n.AbstractMode);r.HTMLMode=w;var p=a.Registry.as(n.Extensions.EditorModes)});