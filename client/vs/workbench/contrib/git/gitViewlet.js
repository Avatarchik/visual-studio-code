/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/gitActions",["require","exports","vs/base/lib/winjs.base","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/base/lifecycle","vs/base/strings","vs/base/types","vs/base/ui/actions","vs/workbench/contrib/git/git","vs/workbench/contrib/git/gitModel","vs/workbench/contrib/git/gitEditorInputs","vs/workbench/ui/parts/editor/editorOptions"],function(e,t,n,r,i,o,s,a,l,c,u,d){function p(e){if(e){if(Array.isArray(e)){if(e.some(function(e){return!(e instanceof c.FileStatus)}))throw new Error("Invalid context.");return e}if(e instanceof c.FileStatus)return[e];if(e instanceof c.StatusGroup)return e.all();throw new Error("Invalid context.")}return e}var h=function(e){function t(t,n,r,i){var o=this;this.gitService=t.gitService,e.call(this,n,r,i,!1),this.toDispose=[this.gitService.addBulkListener2(function(){return o.onGitServiceChange()})],this.onGitServiceChange()}return __extends(t,e),t.prototype.onGitServiceChange=function(){this.updateEnablement()},t.prototype.updateEnablement=function(){this.enabled=this.isEnabled()},t.prototype.isEnabled=function(){return!!this.gitService},t.prototype.run=function(){throw new Error("implement me")},t.prototype.dispose=function(){this.gitService=null,this.toDispose=i.disposeAll(this.toDispose),e.prototype.dispose.call(this)},t}(a.Action);t.AbstractGitAction=h;var m=function(e){function t(n){this.editorService=n.editorService,e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",0),"git-action open-change")}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&!!this.editorService},t.prototype.run=function(e){var t=this;return e instanceof c.FileStatus?this.gitService.getInput(e).then(function(e){var n=new d.TextDiffEditorOptions;return n.forceOpen=!0,t.editorService.openEditor(e,n)}):n.Promise.wrapError(new Error("Can't open change which is not FileStatus."))},t.ID="workbench.git.action.openChange",t}(h);t.OpenChangeAction=m;var f=function(e){function t(n){this.fileService=n.fileService,this.editorService=n.editorService,e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",1),"git-action open-file")}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&!!this.editorService||!!this.fileService},t.prototype.getPath=function(e){if(e.getStatus()===l.Status.INDEX_RENAMED)return e.getRename();var t=this.gitService.getModel().getStatus().find(e.getPath(),l.StatusType.INDEX);return t&&t.getStatus()===l.Status.INDEX_RENAMED?e.getRename():e.getPath()},t.prototype.run=function(e){var r=this;if(!(e instanceof c.FileStatus))return n.Promise.wrapError(new Error("Can't open file."));var i=e;if(t.DELETED_STATES.indexOf(i.getStatus())>-1)return n.Promise.wrapError(new Error("Can't open file which is has been deleted."));var o=this.getPath(i);return this.fileService.resolveFileStat(o).then(function(e){return r.editorService.openEditor({resource:e.resource,mime:e.mime,options:{forceOpen:!0}})})},t.DELETED_STATES=[l.Status.BOTH_DELETED,l.Status.DELETED,l.Status.DELETED_BY_US,l.Status.INDEX_DELETED],t.ID="workbench.git.action.openFile",t}(h);t.OpenFileAction=f;var g=function(e){function t(n){e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",2),"git-action init")}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&this.gitService.getState()===l.ServiceState.NotARepo},t.prototype.run=function(){return this.gitService.init()},t.ID="workbench.git.action.init",t}(h);t.InitAction=g;var v=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",3)),void 0===s&&(s="git-action run-clone"),this.terminalService=n.terminalService,e.call(this,n,i,o,s)}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&!!this.terminalService&&this.gitService.getState()===l.ServiceState.NotARepo},t.prototype.run=function(e){return this.terminalService.execute('git clone "'+e+'" .',!1,!0)},t.ID="workbench.git.action.runClone",t}(h);t.RunCloneAction=v;var b=function(e){function t(n){e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",4),"git-action refresh")}return __extends(t,e),t.prototype.run=function(){return this.gitService.status()},t.ID="workbench.git.action.refresh",t}(h);t.RefreshAction=b;var y=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",5)),void 0===s&&(s="git-action stage"),e.call(this,n,i,o,s),this.editorService=n.editorService}return __extends(t,e),t.prototype.run=function(e){var t=this,r=p(e);return this.gitService.add(p(e)).then(function(e){var i=t.findGitWorkingTreeEditor();if(!i)return n.Promise.as(e);var o=i.input,s=o.getFileStatus();if(r&&r.every(function(e){return e!==s}))return n.Promise.as(e);var a=o.getFileStatus().getPath(),c=e.getStatus().find(a,l.StatusType.INDEX);if(!c)return n.Promise.as(e);var u=i.getControl(),p=u?u.saveViewState():null;return t.gitService.getInput(c).then(function(n){var r=new d.TextDiffEditorOptions;return r.forceOpen=!0,t.editorService.openEditor(n,r,i.position).then(function(){return p&&u.restoreViewState(p),e})})})},t.prototype.findGitWorkingTreeEditor=function(){for(var e=this.editorService.getVisibleEditors(),t=0;t<e.length;t++){var n=e[t];if(u.isGitEditorInput(n.input))return n}return null},t.prototype.dispose=function(){this.editorService=null,e.prototype.dispose.call(this)},t.ID="workbench.git.action.stage",t}(h);t.StageAction=y;var _=function(e){function t(n){e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",6))}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&this.gitService.getModel().getStatus().getWorkingTreeStatus().all().length>0},t.prototype.run=function(){return e.prototype.run.call(this)},t.ID="workbench.git.action.stageAll",t}(y);t.GlobalStageAction=_;var w=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",7)),void 0===s&&(s="git-action undo"),this.eventService=n.eventService,this.editorService=n.editorService,this.messageService=n.messageService,this.fileService=n.fileService,e.call(this,n,i,o,s)}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&!!this.eventService&&!!this.editorService&&!!this.fileService},t.prototype.run=function(e){var t=this;if(!this.messageService.confirm(this.getConfirm(e)))return n.Promise.as(null);var r=[];if(e instanceof c.StatusGroup)r=[this.gitService.undo()];else{for(var i=p(e),o=[],s=[],a=0;a<i.length;a++){var u=i[a].clone();switch(u.getStatus()){case l.Status.UNTRACKED:case l.Status.IGNORED:o.push(u);break;default:s.push(u)}}o.length>0&&r.push(this.gitService.clean(o)),s.length>0&&r.push(this.gitService.checkout("",s))}return n.Promise.join(r).then(function(e){if(0===e.length)return n.Promise.as(null);var r=e[e.length-1],o=t.findWorkingTreeDiffEditor();if(!o)return n.Promise.as(r);var s=o.input,a=s.getFileStatus();if(i&&i.every(function(e){return e!==a}))return n.Promise.as(r);var l=s.getFileStatus().getPath(),c=o.getControl(),u=c?c.getModifiedEditor():null,d=u?u.saveViewState():null;return t.fileService.resolveFileStat(l).then(function(e){return t.editorService.openEditor({resource:e.resource,mime:e.mime,options:{forceOpen:!0}},o.position).then(function(){if(d){var e=o.getControl();e&&e.restoreViewState(d)}})})}).then(null,function(e){return console.error("One or more errors occured",e),n.Promise.wrapError(e[0])})},t.prototype.findWorkingTreeDiffEditor=function(){for(var e=this.editorService.getVisibleEditors(),t=0;t<e.length;t++){var n=e[t];if(n.input instanceof u.GitWorkingTreeDiffEditorInput)return n}return null},t.prototype.getConfirm=function(e){if(e instanceof c.StatusGroup){var t=e,n=t.all(),i=n.length;return{message:r.localize("vs_workbench_contrib_git_gitActions",8),detail:1===i?r.localize("vs_workbench_contrib_git_gitActions",9,i):r.localize("vs_workbench_contrib_git_gitActions",10,i)}}var o=p(e)[0],s=o.getPathComponents().reverse()[0];return{message:r.localize("vs_workbench_contrib_git_gitActions",11,s)}},t.prototype.dispose=function(){this.eventService=null,this.editorService=null,this.fileService=null,e.prototype.dispose.call(this)},t.ID="workbench.git.action.undo",t}(h);t.UndoAction=w;var S=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",12)),void 0===s&&(s="git-action unstage"),this.editorService=n.editorService,e.call(this,n,i,o,s)}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&!!this.editorService},t.prototype.run=function(e){var t=this,r=p(e);return this.gitService.reset("HEAD",r).then(function(e){var i=t.findGitIndexEditor();if(!i)return n.Promise.as(e);var o=i.input,s=o.getFileStatus();if(r&&r.every(function(e){return e!==s}))return n.Promise.as(e);var a=o.getFileStatus().getPath(),c=e.getStatus().find(a,l.StatusType.WORKING_TREE);if(!c)return n.Promise.as(e);var u=i.getControl(),p=u?u.saveViewState():null;return t.gitService.getInput(c).then(function(n){var r=new d.TextDiffEditorOptions;return r.forceOpen=!0,t.editorService.openEditor(n,r,i.position).then(function(){return p&&u.restoreViewState(p),e})})})},t.prototype.findGitIndexEditor=function(){for(var e=this.editorService.getVisibleEditors(),t=0;t<e.length;t++){var n=e[t];if(u.isGitEditorInput(n.input))return n}return null},t.prototype.dispose=function(){this.editorService=null,e.prototype.dispose.call(this)},t.ID="workbench.git.action.unstage",t}(h);t.UnstageAction=S;var E=function(e){function t(n){e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",13))}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&this.gitService.getModel().getStatus().getIndexStatus().all().length>0},t.prototype.run=function(){return e.prototype.run.call(this)},t.ID="workbench.git.action.unstageAll",t}(S);t.GlobalUnstageAction=E;var T=function(e){function t(n){e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",14))}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&this.gitService.getModel().getStatus().getWorkingTreeStatus().all().length>0},t.prototype.run=function(){return e.prototype.run.call(this,this.gitService.getModel().getStatus().getWorkingTreeStatus())},t.ID="workbench.git.action.undoAll",t}(w);t.GlobalUndoAction=T;var k;!function(e){e[e.Alive=0]="Alive",e[e.Disposing=1]="Disposing",e[e.Disposed=2]="Disposed"}(k||(k={}));var C=function(e){function t(n,r){this.editorService=n.editorService,this.branch=r,this.HEAD=null,this.state=k.Alive,this.runPromises=[],e.call(this,n,t.ID,r.name,"git-action checkout")}return __extends(t,e),t.prototype.onGitServiceChange=function(){this.gitService.getState()===l.ServiceState.OK&&(this.HEAD=this.gitService.getModel().getHEAD(),this.class=this.HEAD&&this.HEAD.name===this.branch.name?"git-action checkout HEAD":"git-action checkout"),e.prototype.onGitServiceChange.call(this)},t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&!!this.HEAD},t.prototype.run=function(){var e=this;if(this.state!==k.Alive)return n.Promise.wrapError("action disposed");if(this.HEAD&&this.HEAD.name===this.branch.name)return n.Promise.as(null);var t=this.gitService.checkout(this.branch.name).then(null,function(e){return e.gitErrorCode===l.GitErrorCodes.DirtyWorkTree?n.Promise.wrapError(new Error(r.localize("vs_workbench_contrib_git_gitActions",15))):n.Promise.wrapError(e)});return this.runPromises.push(t),t.done(function(){return e.runPromises.splice(e.runPromises.indexOf(t),1)}),t},t.prototype.dispose=function(){var e=this;this.state===k.Alive&&(this.state=k.Disposing,n.Promise.join(this.runPromises).done(function(){return e.actuallyDispose()}))},t.prototype.actuallyDispose=function(){this.editorService=null,this.branch=null,this.HEAD=null,e.prototype.dispose.call(this),this.state=k.Disposed},t.ID="workbench.git.action.checkout",t}(h);t.CheckoutAction=C;var x=function(e){function t(n,i){void 0===i&&(i=!1),e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",16),"git-action checkout"),this.checkout=i}return __extends(t,e),t.prototype.run=function(e){return s.isString(e)?this.gitService.branch(e,this.checkout):n.Promise.as(!1)},t.ID="workbench.git.action.branch",t}(h);t.BranchAction=x;var A=function(e){function t(t,n,r,i){e.call(this,t,n,r,i)}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&this.gitService.getModel().getStatus().getIndexStatus().all().length>0},t}(h);t.AbstractCommitAction=A;var L=function(e){function t(n){this.terminalService=n.terminalService,e.call(this,n,t.ID,r.localize("vs_workbench_contrib_git_gitActions",17),"git-action run-amend-commit")}return __extends(t,e),t.prototype.isEnabled=function(){return e.prototype.isEnabled.call(this)&&!!this.terminalService},t.prototype.run=function(){return this.terminalService.execute("git commit --amend")},t.ID="workbench.git.action.runAmendCommit",t}(h);t.RunAmendCommitAction=L;var I=function(e){function t(n,i,o,s,a){var l=this;void 0===o&&(o=t.ID),void 0===s&&(s=r.localize("vs_workbench_contrib_git_gitActions",18)),void 0===a&&(a="git-action commit"),e.call(this,n,o,s,a),this.commitState=i,this.toDispose.push(i.addListener2("change/commitInputBox",function(){l.updateEnablement()}))}return __extends(t,e),t.prototype.run=function(){return this.commitState.getCommitMessage()?this.gitService.commit(this.commitState.getCommitMessage()):(this.commitState.onEmptyCommitMessage(),n.Promise.as(null))},t.ID="workbench.git.action.commit",t}(A);t.CommitAction=I;var N=function(e){function t(n,i){e.call(this,n,i,t.ID,r.localize("vs_workbench_contrib_git_gitActions",19),"git-action stage-and-commit")}return __extends(t,e),t.prototype.isEnabled=function(){if(!this.gitService)return!1;if(!this.gitService.isIdle())return!1;var e=this.gitService.getModel().getStatus();return e.getIndexStatus().all().length>0||e.getWorkingTreeStatus().all().length>0},t.prototype.run=function(){return this.commitState.getCommitMessage()?this.gitService.commit(this.commitState.getCommitMessage(),!1,!0):(this.commitState.onEmptyCommitMessage(),n.Promise.as(null))},t.ID="workbench.git.action.stageAndCommit",t}(I);t.StageAndCommitAction=N;var P=function(e){function t(n,r){this.terminalService=n.terminalService,this.messageService=n.messageService,e.call(this,n,r,t.ID,t.ALL,"git-action smart-commit")}return __extends(t,e),t.prototype.onGitServiceChange=function(){if(e.prototype.onGitServiceChange.call(this),!this.enabled)return this.label=t.ALL,void 0;var n=this.gitService.getModel().getStatus();this.label=n.getIndexStatus().all().length>0?t.STAGED:t.ALL},t.prototype.isEnabled=function(){if(!this.gitService)return!1;if(!this.gitService.isIdle())return!1;var e=this.gitService.getModel().getStatus();return e.getIndexStatus().all().length>0||e.getWorkingTreeStatus().all().length>0},t.prototype.run=function(){if(!this.commitState.getCommitMessage())return this.commitState.onEmptyCommitMessage(),n.Promise.as(null);var e=this.gitService.getModel().getStatus();return this.gitService.commit(this.commitState.getCommitMessage(),!1,0===e.getIndexStatus().all().length)},t.ID="workbench.git.action.commitAll",t.ALL=r.localize("vs_workbench_contrib_git_gitActions",20),t.STAGED=r.localize("vs_workbench_contrib_git_gitActions",21),t}(I);t.SmartCommitAction=P;var M=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",22)),void 0===s&&(s="git-action pull"),e.call(this,n,i,o,s)}return __extends(t,e),t.prototype.isEnabled=function(){if(!e.prototype.isEnabled.call(this))return!1;if(!this.gitService.isIdle())return!1;var t=this.gitService.getModel(),n=t.getHEAD();return n&&n.name&&n.upstream?!0:!1},t.prototype.run=function(){return this.gitService.pull().then(null,function(e){return e.gitErrorCode===l.GitErrorCodes.DirtyWorkTree?n.Promise.wrapError(new Error(r.localize("vs_workbench_contrib_git_gitActions",23))):e.gitErrorCode===l.GitErrorCodes.AuthenticationFailed?n.Promise.as(null):n.Promise.wrapError(e)})},t.ID="workbench.git.action.pull",t}(h);t.PullAction=M;var O=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",24)),void 0===s&&(s="git-action push"),e.call(this,n,i,o,s)}return __extends(t,e),t.prototype.isEnabled=function(){if(!e.prototype.isEnabled.call(this))return!1;if(!this.gitService.isIdle())return!1;var t=this.gitService.getModel(),n=t.getHEAD();return n&&n.name&&n.upstream?n.ahead?!0:!1:!1},t.prototype.run=function(){return this.gitService.push().then(null,function(e){return e.gitErrorCode===l.GitErrorCodes.AuthenticationFailed?n.Promise.as(null):n.Promise.wrapError(e)})},t.ID="workbench.git.action.push",t}(h);t.PushAction=O;var R=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",25)),void 0===s&&(s="git-action sync"),e.call(this,n,i,o,s)}return __extends(t,e),t.prototype.isEnabled=function(){if(!e.prototype.isEnabled.call(this))return!1;if(!this.gitService.isIdle())return!1;var t=this.gitService.getModel(),n=t.getHEAD();return n&&n.name&&n.upstream?!0:!1},t.prototype.run=function(){return this.enabled?this.gitService.sync().then(null,function(e){return e.gitErrorCode===l.GitErrorCodes.AuthenticationFailed?n.Promise.as(null):n.Promise.wrapError(e)}):n.Promise.as(null)},t.ID="workbench.git.action.sync",t}(h);t.SyncAction=R;var D=function(e){function t(n,i,o,s){void 0===i&&(i=t.ID),void 0===o&&(o=r.localize("vs_workbench_contrib_git_gitActions",26)),void 0===s&&(s=t.CLASS_NAME),e.call(this,n,i,o,s)}return __extends(t,e),t.prototype.onGitServiceChange=function(){if(e.prototype.onGitServiceChange.call(this),this.gitService.getRunningOperations().some(function(e){return e.id===l.ServiceOperations.SYNC||e.id===l.ServiceOperations.PULL||e.id===l.ServiceOperations.PUSH}))this.label="",this.class=t.CLASS_NAME_LOADING,this.tooltip=r.localize("vs_workbench_contrib_git_gitActions",27);else{this.class=t.CLASS_NAME;var n=this.gitService.getModel(),i=n.getHEAD();i?i.name?i.upstream?i.ahead||i.behind?(this.label=o.format("{0}↓ {1}↑",i.behind,i.ahead),this.tooltip=n.getStatus().getGroups().some(function(e){return e.all().length>0})?r.localize("vs_workbench_contrib_git_gitActions",31):1===i.behind&&1===i.ahead?r.localize("vs_workbench_contrib_git_gitActions",32,i.name,i.behind,i.ahead,i.upstream):1===i.behind?r.localize("vs_workbench_contrib_git_gitActions",33,i.name,i.behind,i.ahead,i.upstream):1===i.ahead?r.localize("vs_workbench_contrib_git_gitActions",34,i.name,i.behind,i.ahead,i.upstream):r.localize("vs_workbench_contrib_git_gitActions",35,i.name,i.behind,i.ahead,i.upstream)):(this.label="",this.tooltip=r.localize("vs_workbench_contrib_git_gitActions",30,i.name)):(this.label="",this.tooltip=r.localize("vs_workbench_contrib_git_gitActions",29,i.name)):(this.label="",this.tooltip=r.localize("vs_workbench_contrib_git_gitActions",28)):(this.label="",this.tooltip="")}},t.ID="workbench.git.action.liveSync",t.CLASS_NAME="git-action live-sync",t.CLASS_NAME_LOADING="git-action live-sync loading",t}(R);t.LiveSyncAction=D});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/views/changes/changesViewer",["require","exports","vs/base/lib/winjs.base","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/base/errors","vs/base/ui/comparers","vs/base/env","vs/base/dom/builder","vs/base/ui/widgets/actionbar","vs/base/ui/widgets/leftRightWidget/leftRightWidget","vs/base/ui/widgets/countBadge/countBadge","vs/base/ui/widgets/tree/tree","vs/base/ui/widgets/tree/treeDnd","vs/base/ui/widgets/tree/treeDefaults","vs/base/ui/widgets/tree/actionsRenderer","vs/workbench/contrib/git/git","vs/workbench/contrib/git/gitModel","vs/workbench/contrib/git/gitActions","vs/base/severity"],function(e,t,n,r,i,o,s,a,l,c,u,d,p,h,m,f,g,v,b){function y(e){return s.isNative&&s.isWindows?e.replace(/\//g,"\\"):e}var _=a.$,w=function(){function e(e){this.cache={},this.instantiationService=e.instantiationService}return e.prototype.getAction=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.cache[e.ID];return r||(t.unshift(e),r=this.cache[e.ID]=this.instantiationService.createInstance.apply(this.instantiationService,t)),r},e.prototype.dispose=function(){var e=this;Object.keys(this.cache).forEach(function(t){e.cache[t].dispose()}),this.cache=null},e}();t.ActionContainer=w;var S=function(){function e(){}return e.prototype.getId=function(e,t){if(t instanceof g.StatusModel)return"root";if(t instanceof g.StatusGroup){var n=t;switch(n.getType()){case f.StatusType.INDEX:return"index";case f.StatusType.WORKING_TREE:return"workingTree";case f.StatusType.MERGE:return"merge";default:throw new Error("Invalid group type")}}var r=t;return r.getId()},e.prototype.hasChildren=function(e,t){if(t instanceof g.StatusModel)return!0;if(t instanceof g.StatusGroup){var n=t;return n.all().length>0}},e.prototype.getChildren=function(e,t){if(t instanceof g.StatusModel){var r=t;return n.Promise.as(r.getGroups())}if(t instanceof g.StatusGroup){var i=t;return n.Promise.as(i.all())}return n.Promise.as([])},e.prototype.getParent=function(){return n.Promise.as(null)},e}();t.DataSource=S;var E=function(e){function t(t){e.call(this,t),this.gitService=t.gitService}return __extends(t,e),t.prototype.hasActions=function(e,t){return t instanceof g.FileStatus?!0:t instanceof g.StatusGroup&&t.all().length>0?!0:!1},t.prototype.getActions=function(e,t){var r=[];switch(t.getType()){case f.StatusType.INDEX:r.push(this.getAction(t instanceof g.StatusGroup?v.GlobalUnstageAction:v.UnstageAction));break;case f.StatusType.WORKING_TREE:r.push(this.getAction(t instanceof g.StatusGroup?v.GlobalUndoAction:v.UndoAction)),r.push(this.getAction(t instanceof g.StatusGroup?v.GlobalStageAction:v.StageAction));break;case f.StatusType.MERGE:r.push(this.getAction(v.StageAction))}return n.Promise.as(r)},t.prototype.hasSecondaryActions=function(e,t){return this.hasActions(e,t)},t.prototype.getSecondaryActions=function(e,t){var n=this;return this.getActions(e,t).then(function(e){if(t instanceof g.FileStatus){var r=t,i=r.getStatus();e.push(new l.Separator),i!==f.Status.DELETED&&i!==f.Status.INDEX_DELETED&&e.push(n.getAction(v.OpenFileAction)),e.push(n.getAction(v.OpenChangeAction))}return e.reverse(),e})},t.prototype.getActionItem=function(){return null},t}(w);t.ActionProvider=E;var T=function(e){function t(t,n,r){e.call(this,{actionProvider:n,actionRunner:r}),this.contextService=t.contextService,this.messageService=t.messageService}return __extends(t,e),t.prototype.getContentHeight=function(){return 24},t.prototype.renderContents=function(e,n,i){for(;i.firstChild;)i.removeChild(i.firstChild);var o;if(n instanceof g.StatusGroup){o=_(".status-group").appendTo(i);var a="",l=n;switch(l.getType()){case f.StatusType.INDEX:a=r.localize("vs_workbench_contrib_git_views_changes_changesViewer",0);break;case f.StatusType.WORKING_TREE:a=r.localize("vs_workbench_contrib_git_views_changes_changesViewer",1);break;case f.StatusType.MERGE:a=r.localize("vs_workbench_contrib_git_views_changes_changesViewer",2)}new c.LeftRightWidget(o,function(e){return s.browser.isIE9?_("a.plain").href("#").text(a).appendTo(e):_("span").text(a).appendTo(e)},function(e){return new u.CountBadge(e,l.all().length)})}else{o=_(".file-status").addClass(t.statusToClass(n.getStatus())).appendTo(i);var d=n,p=d.getStatus(),h=d.getRename();if(h)var m=h.lastIndexOf("/"),v=-1===m?h:h.substr(m+1,h.length),b="/"+(-1===m?"":h.substr(0,m));_("span.status").text(t.statusToChar(p)).title(t.statusToTitle(p)).appendTo(o);var w=d.getPath(),S=w.lastIndexOf("/"),E=-1===S?w:w.substr(S+1,w.length),T="/"+(-1===S?"":w.substr(0,S));_("a.name.plain").text(v||E).appendTo(o),_("span.folder").text(y(b||T)).appendTo(o),p===f.Status.INDEX_RENAMED&&(_("span.rename-arrow").text("←").appendTo(o),_("span.rename").text(E).appendTo(o),_("span.rename-folder").text(y(T)).appendTo(o))}return null},t.statusToChar=function(e){switch(e){case f.Status.INDEX_MODIFIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",3);case f.Status.MODIFIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",4);case f.Status.INDEX_ADDED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",5);case f.Status.INDEX_DELETED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",6);case f.Status.DELETED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",7);case f.Status.INDEX_RENAMED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",8);case f.Status.INDEX_COPIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",9);case f.Status.UNTRACKED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",10);case f.Status.IGNORED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",11);case f.Status.BOTH_DELETED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",12);case f.Status.ADDED_BY_US:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",13);case f.Status.DELETED_BY_THEM:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",14);case f.Status.ADDED_BY_THEM:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",15);case f.Status.DELETED_BY_US:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",16);case f.Status.BOTH_ADDED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",17);case f.Status.BOTH_MODIFIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",18);default:return""}},t.statusToTitle=function(e){switch(e){case f.Status.INDEX_MODIFIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",19);case f.Status.MODIFIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",20);case f.Status.INDEX_ADDED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",21);case f.Status.INDEX_DELETED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",22);case f.Status.DELETED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",23);case f.Status.INDEX_RENAMED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",24);case f.Status.INDEX_COPIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",25);case f.Status.UNTRACKED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",26);case f.Status.IGNORED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",27);case f.Status.BOTH_DELETED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",28);case f.Status.ADDED_BY_US:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",29);case f.Status.DELETED_BY_THEM:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",30);case f.Status.ADDED_BY_THEM:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",31);case f.Status.DELETED_BY_US:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",32);case f.Status.BOTH_ADDED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",33);case f.Status.BOTH_MODIFIED:return r.localize("vs_workbench_contrib_git_views_changes_changesViewer",34);default:return""}},t.statusToClass=function(e){switch(e){case f.Status.INDEX_MODIFIED:return"modified";case f.Status.MODIFIED:return"modified";case f.Status.INDEX_ADDED:return"added";case f.Status.INDEX_DELETED:return"deleted";case f.Status.DELETED:return"deleted";case f.Status.INDEX_RENAMED:return"renamed";case f.Status.INDEX_COPIED:return"copied";case f.Status.UNTRACKED:return"untracked";case f.Status.IGNORED:return"ignored";case f.Status.BOTH_DELETED:return"conflict both-deleted";case f.Status.ADDED_BY_US:return"conflict added-by-us";case f.Status.DELETED_BY_THEM:return"conflict deleted-by-them";case f.Status.ADDED_BY_THEM:return"conflict added-by-them";case f.Status.DELETED_BY_US:return"conflict deleted-by-us";case f.Status.BOTH_ADDED:return"conflict both-added";case f.Status.BOTH_MODIFIED:return"conflict both-modified";default:return""}},t.prototype.getActionContext=function(e,t){return t},t.prototype.onError=function(e){this.messageService.show(b.Error,e)},t}(m.ActionsRenderer);t.Renderer=T;var k=function(){function e(){}return e.prototype.isVisible=function(e,t){if(t instanceof g.StatusGroup){var n=t;switch(n.getType()){case f.StatusType.INDEX:case f.StatusType.MERGE:return n.all().length>0;case f.StatusType.WORKING_TREE:return!0}}return!0},e}();t.Filter=k;var C=function(){function e(){}return e.prototype.compare=function(t,n,r){return n instanceof g.FileStatus&&r instanceof g.FileStatus?e.compareStatus(n,r):0},e.compareStatus=function(e,t){for(var n,r,i,s,a=e.getPathComponents(),l=t.getPathComponents(),c=a.length-1,u=l.length-1,d=0;;d++){if(n=c===d,r=u===d,n&&r)return o.compareFileNames(a[d],l[d]);if(n)return-1;if(r)return 1;if((i=a[d].toLowerCase())!==(s=l[d].toLowerCase()))return s>i?-1:1}},e}();t.Sorter=C;var x=function(e){function t(t){e.call(this,t),this.gitService=t.gitService,this.messageService=t.messageService}return __extends(t,e),t.prototype.getDragURI=function(e,t){if(t instanceof g.StatusGroup){var n=t;return"git:"+n.getType()}if(t instanceof g.FileStatus){var r=t;return"git:"+r.getType()+":"+r.getPath()}return null},t.prototype.onDragStart=function(){},t.prototype.onDragOver=function(e,t,n){if(!this.gitService.isIdle())return d.DRAG_OVER_REJECT;if(!(t instanceof p.ElementsDragAndDropData))return d.DRAG_OVER_REJECT;var r=t.getData(),i=r[0];if(i instanceof g.StatusGroup){var o=i;return this.onDrag(n,o.getType())}if(i instanceof g.FileStatus){var s=i;return this.onDrag(n,s.getType())}return d.DRAG_OVER_REJECT},t.prototype.onDrag=function(e,t){return t===f.StatusType.WORKING_TREE?this.onDragWorkingTree(e):t===f.StatusType.INDEX?this.onDragIndex(e):t===f.StatusType.MERGE?this.onDragMerge(e):d.DRAG_OVER_REJECT},t.prototype.onDragWorkingTree=function(e){if(e instanceof g.StatusGroup){var t=e;return t.getType()===f.StatusType.INDEX?d.DRAG_OVER_ACCEPT_BUBBLE_DOWN:d.DRAG_OVER_REJECT}if(e instanceof g.FileStatus){var n=e;return n.getType()===f.StatusType.INDEX?d.DRAG_OVER_ACCEPT_BUBBLE_UP:d.DRAG_OVER_REJECT}return d.DRAG_OVER_REJECT},t.prototype.onDragIndex=function(e){if(e instanceof g.StatusGroup){var t=e;return t.getType()===f.StatusType.WORKING_TREE?d.DRAG_OVER_ACCEPT_BUBBLE_DOWN:d.DRAG_OVER_REJECT}if(e instanceof g.FileStatus){var n=e;return n.getType()===f.StatusType.WORKING_TREE?d.DRAG_OVER_ACCEPT_BUBBLE_UP:d.DRAG_OVER_REJECT}return d.DRAG_OVER_REJECT},t.prototype.onDragMerge=function(e){if(e instanceof g.StatusGroup){var t=e;return t.getType()===f.StatusType.INDEX?d.DRAG_OVER_ACCEPT_BUBBLE_DOWN:d.DRAG_OVER_REJECT}if(e instanceof g.FileStatus){var n=e;return n.getType()===f.StatusType.INDEX?d.DRAG_OVER_ACCEPT_BUBBLE_UP:d.DRAG_OVER_REJECT}return d.DRAG_OVER_REJECT},t.prototype.drop=function(e,t,n){var r,i=this,o=t.getData(),s=o[0];if(s instanceof g.StatusGroup)r=s.all();else{if(!(s instanceof g.FileStatus))throw new Error("Invalid drag and drop data.");r=[s]}var a=n;a.getType()===f.StatusType.INDEX&&this.getAction(v.StageAction).run(r).done(null,function(e){return i.onError(e)}),a.getType()===f.StatusType.WORKING_TREE&&this.getAction(v.UnstageAction).run(r).done(null,function(e){return i.onError(e)
})},t.prototype.onError=function(e){this.messageService.show(b.Error,e)},t}(w);t.DragAndDrop=x;var A=function(e){function t(t,n){e.call(this,{clickBehavior:h.ClickBehavior.ON_MOUSE_DOWN}),this.actionProvider=n,this.contextMenuService=t.contextMenuService}return __extends(t,e),t.prototype.onLeftClick=function(t,n,r){return n instanceof g.StatusGroup?(r.preventDefault(),r.stopPropagation(),!0):e.prototype.onLeftClick.call(this,t,n,r)},t.prototype.onEnter=function(t,n){var r=t.getFocus();return r&&r instanceof g.StatusGroup?(t.isExpanded(r)?t.collapse(r).done(null,i.onUnexpectedError):t.expand(r).done(null,i.onUnexpectedError),!0):e.prototype.onEnter.call(this,t,n)},t.prototype.onContextMenu=function(e,t,n){var r=this;if(n.target&&n.target.tagName&&"input"===n.target.tagName.toLowerCase())return!1;if(n.preventDefault(),n.stopPropagation(),e.setFocus(t),this.actionProvider.hasSecondaryActions(e,t)){var i={x:n.posx+1,y:n.posy};return this.contextMenuService.showContextMenu({getAnchor:function(){return i},getActions:function(){return r.actionProvider.getSecondaryActions(e,t)},getActionItem:this.actionProvider.getActionItem.bind(this.actionProvider,e,t),getActionsContext:function(){return t},onHide:function(t){t&&e.DOMFocus()}}),!0}return!1},t}(h.DefaultController);t.Controller=A}),define("vs/css!vs/workbench/contrib/git/views/changes/changesView",["vs/css!vs/workbench/contrib/git/gitViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/views/changes/changesView",["require","exports","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/platform/services","vs/base/env","vs/base/lifecycle","vs/base/eventEmitter","vs/base/strings","vs/base/errors","vs/base/lib/winjs.base","vs/base/dom/builder","vs/base/dom/keyboardEvent","vs/base/ui/widgets/actionbar","vs/base/ui/widgets/tree/treeImpl","vs/workbench/events","vs/workbench/contrib/git/git","vs/workbench/contrib/git/gitActions","vs/workbench/contrib/git/gitModel","vs/workbench/contrib/git/views/changes/changesViewer","vs/workbench/contrib/git/gitEditorInputs","vs/workbench/contrib/files/files","vs/workbench/ui/parts/editor/editorOptions","vs/base/ui/widgets/inputBox","vs/base/severity","vs/css!./changesView"],function(e,t,n,r,i,o,s,a,l,c,u,d,p,h,m,f,g,v,b,y,_,w,S,E){var T=u.$,k=function(e){function t(t,n){var r=this;e.call(this),this.ID="changes",this.instantiationService=t.instantiationService,this.editorService=t.editorService,this.messageService=t.messageService,this.contextViewService=t.contextViewService,this.contextService=t.contextService,this.gitService=t.gitService,this.visible=!1,this.currentDimension=null,this.actionRunner=n,this.toDispose=[this.smartCommitAction=this.instantiationService.createInstance(g.SmartCommitAction,this),t.eventService.addListener2(m.EventType.EDITOR_INPUT_CHANGED,function(e){return r.onEditorInputChanged(e.editorInput).done(null,l.onUnexpectedError)}),this.gitService.addListener2(f.ServiceEvents.OPERATION_START,function(e){return r.onGitOperationStart(e)}),this.gitService.addListener2(f.ServiceEvents.OPERATION_END,function(e){return r.onGitOperationEnd(e)}),this.gitService.getModel().addListener2(f.ModelEvents.MODEL_UPDATED,this.onGitModelUpdate.bind(this))]}return __extends(t,e),Object.defineProperty(t.prototype,"element",{get:function(){return this.render(),this.$el.getHTMLElement()},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;if(!this.$el){this.$el=T(".changes-view"),this.$commitView=T(".commit-view").appendTo(this.$el),this.commitInputBox=new S.InputBox(this.$commitView,this.contextViewService,{placeholder:n.localize("vs_workbench_contrib_git_views_changes_changesView",0),validationOptions:{showMessage:!0,validation:function(){return null}}}),this.addEmitter2(this.commitInputBox,"commitInputBox"),T(this.commitInputBox.inputElement).on("keypress",function(n){var r=new d.KeyboardEvent(n),o=r.asString();(13===n.keyCode||o===(i.isMacintosh?"Cmd-S":"Ctrl-S"))&&(e.smartCommitAction.enabled?e.actionRunner.run(e.smartCommitAction).done():e.commitInputBox.showMessage({content:t.NOTHING_TO_COMMIT,formatContent:!0,type:S.MessageType.INFO}))}).on("blur",function(){e.commitInputBox.hideMessage()}),this.$statusView=T(".status-view").appendTo(this.$el);var r=this.instantiationService.createInstance(b.ActionProvider),o=this.instantiationService.createInstance(b.Renderer,r,this.actionRunner),s=this.instantiationService.createInstance(b.DragAndDrop),a=this.instantiationService.createInstance(b.Controller,r);this.tree=new h.Tree(this.$statusView.getHTMLElement(),{dataSource:new b.DataSource,renderer:o,filter:new b.Filter,sorter:new b.Sorter,dnd:s,controller:a},{indentPixels:0,twistiePixels:20}),this.tree.setInput(this.gitService.getModel().getStatus()),this.tree.expandAll(this.gitService.getModel().getStatus().getGroups()),this.toDispose.push(o),this.toDispose.push(this.tree.addListener2("selection",function(t){return e.onSelection(t)}))}},t.prototype.focus=function(){var e=this.tree.getSelection();e.length>0&&this.tree.reveal(e[0],.5),this.tree.DOMFocus()},t.prototype.layout=function(e){if(void 0===e&&(e=this.currentDimension),e){this.currentDimension=e;var t=e.height-38;this.$statusView.size(e.width,t),this.tree.layout(t)}},t.prototype.setVisible=function(e){return this.visible=e,e?(this.tree.onVisible(),this.onEditorInputChanged(this.editorService.getActiveEditorInput())):(this.tree.onHidden(),c.Promise.as(null))},t.prototype.getSelection=function(){return new r.StructuredSelection(this.tree.getSelection())},t.prototype.getControl=function(){return this.tree},t.prototype.getActions=function(){var e=this;return this.actions||(this.actions=[this.smartCommitAction,this.instantiationService.createInstance(g.RefreshAction)],this.actions.forEach(function(t){return e.toDispose.push(t)})),this.actions},t.prototype.getSecondaryActions=function(){var e=this;return this.secondaryActions||(this.secondaryActions=[this.instantiationService.createInstance(g.SyncAction),this.instantiationService.createInstance(g.PullAction),this.instantiationService.createInstance(g.PushAction),new p.Separator,this.instantiationService.createInstance(g.CommitAction,this),this.instantiationService.createInstance(g.StageAndCommitAction,this)],i.isNative||this.secondaryActions.push(this.instantiationService.createInstance(g.RunAmendCommitAction)),this.secondaryActions.push(new p.Separator,this.instantiationService.createInstance(g.GlobalUnstageAction),this.instantiationService.createInstance(g.GlobalUndoAction)),this.secondaryActions.forEach(function(t){return e.toDispose.push(t)})),this.secondaryActions},t.prototype.getCommitMessage=function(){return a.trim(this.commitInputBox.value)},t.prototype.onEmptyCommitMessage=function(){this.commitInputBox.focus(),this.commitInputBox.showMessage({content:t.NEED_MESSAGE,formatContent:!0,type:S.MessageType.INFO})},t.prototype.onGitModelUpdate=function(){var e=this;this.tree&&this.tree.refresh().done(function(){return e.tree.expandAll(e.gitService.getModel().getStatus().getGroups())})},t.prototype.onEditorInputChanged=function(e){var t=this;if(!this.tree)return c.Promise.as(null);var n=this.getStatusFromInput(e);return n||(this.tree.clearSelection(),this.tree.clearFocus()),this.visible&&-1===this.tree.getSelection().indexOf(n)?this.tree.reveal(n,.5).then(function(){t.tree.setSelection([n],{origin:"implicit"}),t.tree.setFocus(n)}):c.Promise.as(null)},t.prototype.onSelection=function(e){var t=this;if((!e.payload||"implicit"!==e.payload.origin)&&e.selection.length){var n=e.selection[0];if(n instanceof v.FileStatus){var r=n,i="mouse"===e.payload.origin;this.gitService.getInput(r).done(function(n){var r=new w.TextDiffEditorOptions;i&&(r.preserveFocus=!0),r.forceOpen=!0;var o=e&&e.payload&&e.payload.originalEvent&&(e.payload.originalEvent.ctrlKey||e.payload.originalEvent.metaKey);return t.editorService.openEditor(n,r,o)},function(e){return e.gitErrorCode===f.GitErrorCodes.CantOpenResource?(t.messageService.show(E.Warning,e),void 0):(t.messageService.show(E.Error,e),void 0)})}}},t.prototype.onGitOperationStart=function(e){e.id===f.ServiceOperations.COMMIT&&this.commitInputBox&&this.commitInputBox.disable()},t.prototype.onGitOperationEnd=function(e){e.operation.id===f.ServiceOperations.COMMIT&&this.commitInputBox&&(this.commitInputBox.enable(),e.error||(this.commitInputBox.value=""))},t.prototype.getStatusFromInput=function(e){if(!e)return null;if(e instanceof y.GitDiffEditorInput)return e.getFileStatus();if(e instanceof y.GitIndexEditorInput)return e.getFileStatus()||null;if(e instanceof y.NativeGitIndexStringEditorInput)return e.getFileStatus()||null;if(e instanceof _.FileEditorInput){var t=e,n=this.contextService.toWorkspaceRelativePath(t.getResource());if(!n)return null;var r=this.gitService.getModel().getStatus().getWorkingTreeStatus().find(n);if(r&&(r.getStatus()===f.Status.UNTRACKED||r.getStatus()===f.Status.IGNORED))return r;if(r=this.gitService.getModel().getStatus().getMergeStatus().find(n))return r}return null},t.prototype.dispose=function(){this.$el&&(this.$el.dispose(),this.$el=null),this.toDispose=o.disposeAll(this.toDispose),e.prototype.dispose.call(this)},t.NEED_MESSAGE=n.localize("vs_workbench_contrib_git_views_changes_changesView",1,"Enter"),t.NOTHING_TO_COMMIT=n.localize("vs_workbench_contrib_git_views_changes_changesView",2,"Enter"),t}(s.EventEmitter);t.ChangesView=k}),define("vs/css!vs/base/ui/widgets/comboBox",["vs/css!vs/workbench/contrib/git/gitViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/base/ui/widgets/comboBox",["require","exports","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/base/types","vs/base/lib/winjs.base","vs/base/dom/builder","vs/base/eventEmitter","vs/css!./comboBox"],function(e,t,n,r,i,o,s){var a=o.$,l=function(e){function t(t){var n=this;e.call(this),this.isEnabled=!0,this.$el=a("select.combo-box").appendTo(t),this.options=[],this.optionsPromise=null,this.optionsPromiseError=null,this.$el.on("change",function(e){return n.onChange(e)}),this.render()}return __extends(t,e),t.prototype.setOptions=function(e){var t=this;return this.optionsPromise&&this.optionsPromise.cancel(),this.optionsPromise=null,this.optionsPromiseError=null,r.isArray(e)?(this.options=e,this.render(),e.length>0&&this.onChange(),i.Promise.as(this.options)):(this.optionsPromise=e.then(function(e){return t.optionsPromise=null,t.options=e,t.render(),e.length>0&&t.onChange(),e},function(e){return t.optionsPromise=null,t.optionsPromiseError=e,t.render(),i.Promise.wrapError(e)}),this.render(),this.optionsPromise)},Object.defineProperty(t.prototype,"enabled",{get:function(){return this.isEnabled},set:function(e){e?this.enable():this.disable(),this.isEnabled=e},enumerable:!0,configurable:!0}),t.prototype.getOptions=function(){return this.options?this.options.slice(0):null},t.prototype.getSelectedOption=function(){if(this.$el){var e=this.$el.getHTMLElement().selectedIndex;return this.options[e]}},t.prototype.onChange=function(){var e=this.getSelectedOption();e&&e.value&&this.emit("change",e)},t.prototype.render=function(){var e=this;this.$el&&(this.$el.empty().setClass("combo-box"),this.optionsPromiseError?(this.$el.addClass("error").append(a("option.combo-box-option").innerHtml(t.ERROR_LABEL)),this.disable()):this.optionsPromise?(this.$el.addClass("loading").append(a("option.combo-box-option").innerHtml(t.LOADING_LABEL)),this.disable()):0===this.options.length?(this.$el.addClass("empty").append(a("option.combo-box-option").innerHtml(t.EMPTY_LABEL)),this.disable()):(this.options.forEach(function(t){var n=a("option.combo-box-option").text(t.label).appendTo(e.$el);t.value?n.attr("value",t.value):n.addClass("label")}),this.isEnabled&&this.enable()))},t.prototype.enable=function(){this.$el.getHTMLElement().removeAttribute("disabled")},t.prototype.disable=function(){this.$el.attr("disabled","true")},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.$el&&(this.$el.destroy(),this.$el=null)},t.EMPTY_LABEL=n.localize("vs_base_ui_widgets_comboBox",0),t.LOADING_LABEL=n.localize("vs_base_ui_widgets_comboBox",1),t.ERROR_LABEL=n.localize("vs_base_ui_widgets_comboBox",2),t}(s.EventEmitter);t.ComboBox=l}),define("vs/workbench/contrib/tfs/tfs",["require","exports"],function(e,t){!function(e){e[e.Unavailable=0]="Unavailable",e[e.Uninitialized=1]="Uninitialized",e[e.Initialized=2]="Initialized",e[e.Connected=3]="Connected",e[e.Disconnected=4]="Disconnected"}(t.ServiceState||(t.ServiceState={}));t.ServiceState;t.ServiceEvents={STATE_CHANGED:"state",ERROR:"error"},t.TFS_SERVICE_ID="tfsService"}),define("vs/css!vs/workbench/contrib/git/views/empty/emptyView",["vs/css!vs/workbench/contrib/git/gitViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/views/empty/emptyView",["require","exports","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/base/env","vs/platform/services","vs/base/lifecycle","vs/base/eventEmitter","vs/base/dom/dom","vs/base/errors","vs/base/dom/keyboardEvent","vs/base/lib/winjs.base","vs/base/dom/builder","vs/base/ui/actions","vs/base/ui/widgets/inputBox","vs/base/ui/widgets/comboBox","vs/workbench/contrib/git/git","vs/workbench/contrib/git/gitActions","vs/workbench/contrib/files/files","vs/workbench/contrib/tfs/tfs","vs/base/severity","vs/css!./emptyView"],function(e,t,n,r,i,o,s,a,l,c,u,d,p,h,m,f,g,v,b,y){var _=d.$,w=function(e){function t(t){var n=this;e.call(this),this.$el=_("a.button.clone").href("#").appendTo(t),this.$el.on("click",function(e){return n.enabled?(n.emit("click",e),void 0):(a.EventHelper.stop(e),void 0)})}return __extends(t,e),Object.defineProperty(t.prototype,"label",{set:function(e){this.$el.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return!this.$el.hasClass("disabled")},set:function(e){e?this.$el.removeClass("disabled"):this.$el.addClass("disabled")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.$el&&(this.$el.dispose(),this.$el=null),e.prototype.dispose.call(this)},t}(s.EventEmitter);t.Button=w;var S=function(e){function t(t,n,r){var i=this;e.call(this),this.ID="empty",this.gitService=t.gitService,this.instantiationService=t.instantiationService,this.messageService=t.messageService,this.fileService=t.fileService,this.terminalService=t.terminalService,this.viewletService=t.viewletService,this.contextViewService=t.contextViewService,this.tfsService=t.tfsService,this.refreshAction=new p.Action("workbench.contrib.git.empty.refresh","Refresh","git-action refresh",!0,function(){return i.renderTFSSection(),null}),this.actionRunner=r,this.isVisible=!1,this.needsRender=!1,this.controller=n,this.toDispose=[],this.tfsService&&(this.toDispose.push(this.tfsService.addListener2(b.ServiceEvents.STATE_CHANGED,function(){return i.onTFSServiceStateChange()})),this.onTFSServiceStateChange())}return __extends(t,e),Object.defineProperty(t.prototype,"initAction",{get:function(){return this._initAction||(this._initAction=this.instantiationService.createInstance(g.InitAction)),this._initAction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cloneAction",{get:function(){return this._cloneAction||(this._cloneAction=this.instantiationService.createInstance(g.RunCloneAction)),this._cloneAction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this.render(),this.$el.getHTMLElement()},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;if(!this.$el){if(this.$el=_(".empty-view"),_("p").appendTo(this.$el).text(t.EMPTY_MESSAGE),this.tfsSection=_(".section").appendTo(this.$el).getHTMLElement(),!r.isNative){var i=_(".section").appendTo(this.$el);this.urlInputBox=new h.InputBox(i,this.contextViewService,{placeholder:n.localize("vs_workbench_contrib_git_views_empty_emptyView",0),validationOptions:{showMessage:!1,validation:function(t){var n=/^(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(t);return e.cloneButton.enabled=n,!t||n?null:{content:"",type:h.MessageType.ERROR}}}}),_(this.urlInputBox.inputElement).on("keyup",function(t){var n=new c.KeyboardEvent(t);"Enter"===n.asString()&&e.cloneButton.enabled&&(n.preventDefault(),n.stopPropagation(),e.disableUI(),e.clone(e.urlInputBox.value.trim()).then(null,function(t){e.messageService.show(y.Error,t)}).done(function(){e.enableUI()}))}),this.cloneButton=new w(i),this.cloneButton.enabled=!1,this.cloneButton.label=n.localize("vs_workbench_contrib_git_views_empty_emptyView",1),this.cloneButton.on("click",function(t){a.EventHelper.stop(t),e.disableUI(),e.clone(e.urlInputBox.value.trim()).then(null,function(t){e.messageService.show(y.Error,t)}).done(function(){e.enableUI()})})}var o=_(".section").appendTo(this.$el);this.initButton=new w(o),this.initButton.label=n.localize("vs_workbench_contrib_git_views_empty_emptyView",2),this.initButton.on("click",function(t){a.EventHelper.stop(t),e.disableUI(),e.actionRunner.run(e.initAction).done(function(){e.enableUI()})}),this.toDispose.push(this.gitService.addListener2(f.ServiceEvents.OPERATION,function(){return e.onGitOperation()}))}},t.prototype.disableUI=function(){this.tfsConnectButton&&(this.tfsConnectButton.enabled=!1),this.tfsGitRepositoresComboBox&&(this.tfsGitRepositoresComboBox.enabled=!1),this.tfsCloneButton&&(this.tfsCloneButton.enabled=!1),this.urlInputBox&&this.urlInputBox.disable(),this.cloneButton&&(this.cloneButton.enabled=!1),this.initButton.enabled=!1},t.prototype.enableUI=function(){this.gitService.getRunningOperations().length>0||(this.tfsConnectButton&&(this.tfsConnectButton.enabled=!0),this.tfsGitRepositoresComboBox&&(this.tfsGitRepositoresComboBox.enabled=!0),this.tfsCloneButton&&(this.tfsCloneButton.enabled=this.tfsGitRepositoresComboBox?this.tfsGitRepositoresComboBox.getOptions().length>0:!1),this.urlInputBox&&(this.urlInputBox.enable(),this.urlInputBox.validate()),this.initButton.enabled=!0)},t.prototype.clone=function(e){var t=this;return this.fileService.resolveFileStat("/").then(function(r){var i=r.children.length?r.children[0]:null,o=i&&!i.isDirectory&&"hostingstart.html"===i.name;if(r.children.length>1||1===r.children.length&&!o)return t.messageService.show(y.Warning,n.localize("vs_workbench_contrib_git_views_empty_emptyView",3)),void 0;if(e){var s=function(){return t.actionRunner.run(t.cloneAction,e).then(function(){return t.urlInputBox.value="",t.viewletService.openViewlet(v.VIEWLET_ID,!1)})};return o?t.fileService.deleteFile(i).then(s):s()}},function(e){return t.onError(e)})},t.prototype.onError=function(e){this.messageService.show(y.Error,e)},t.prototype.focus=function(){},t.prototype.layout=function(){},t.prototype.setVisible=function(e){return this.isVisible=e,e&&this.needsRender&&(this.needsRender=!1,this.renderTFSSection()),u.Promise.as(null)},t.prototype.getSelection=function(){return i.Selection.EMPTY},t.prototype.getControl=function(){return null},t.prototype.getActions=function(){return[this.refreshAction]},t.prototype.getSecondaryActions=function(){return[]},t.prototype.onTFSServiceStateChange=function(){this.isVisible?this.renderTFSSection():this.needsRender=!0},t.prototype.renderTFSSection=function(){var e=this;switch(this.disposeTFSSection(),this.tfsService.state){case b.ServiceState.Connected:this.tfsGitRepositoresComboBox=new m.ComboBox(this.tfsSection),this.tfsGitRepositoresComboBox.setOptions(this.tfsService.getRepositories().then(function(t){var r=t.length>0;return e.tfsCloneButton.enabled=r,e.tfsGitRepositoresComboBox.enabled=r,r?u.Promise.as(t.sort(function(e,t){return e.project.name!==t.project.name?e.project.name<t.project.name?-1:1:e.name<t.name?-1:1}).map(function(e){return{label:n.localize("vs_workbench_contrib_git_views_empty_emptyView",5,e.name,e.project.name),value:e.remoteUrl}})):u.Promise.as([{label:n.localize("vs_workbench_contrib_git_views_empty_emptyView",4)}])})).done(null,function(t){if(t instanceof l.ConnectionError){var r=t;if(401===r.status){var i=e.messageService.show(y.Warning,{message:r.responseText,actions:[new p.Action("workbench.contrib.git.empty.tfsReconnectClose",n.localize("vs_workbench_contrib_git_views_empty_emptyView",6),null,!0,function(){return i(),null}),new p.Action("workbench.contrib.git.empty.tfsReconnect",n.localize("vs_workbench_contrib_git_views_empty_emptyView",7),null,!0,function(){return window.location.href=e.tfsService.getConnectURL(),null})]});return}}e.onError(t)}),this.tfsCloneButton=new w(this.tfsSection),this.tfsCloneButton.enabled=!1,this.tfsCloneButton.label=n.localize("vs_workbench_contrib_git_views_empty_emptyView",8),this.tfsCloneButton.on("click",function(t){a.EventHelper.stop(t);var n=e.tfsGitRepositoresComboBox.getSelectedOption();n&&n.value&&(e.disableUI(),e.clone(n.value).then(null,function(t){e.messageService.show(y.Error,t)}).done(function(){e.enableUI()}))});break;case b.ServiceState.Disconnected:this.tfsConnectButton=new w(this.tfsSection),this.tfsConnectButton.label=n.localize("vs_workbench_contrib_git_views_empty_emptyView",9),this.tfsConnectButton.on("click",function(t){a.EventHelper.stop(t),window.location.href=e.tfsService.getConnectURL()})}},t.prototype.disposeTFSSection=function(){for(;this.tfsSection&&this.tfsSection.firstChild;)this.tfsSection.removeChild(this.tfsSection.firstChild);this.tfsConnectButton&&(this.tfsConnectButton.dispose(),this.tfsConnectButton=null),this.tfsGitRepositoresComboBox&&(this.tfsGitRepositoresComboBox.dispose(),this.tfsGitRepositoresComboBox=null),this.tfsCloneButton&&(this.tfsCloneButton.dispose(),this.tfsCloneButton=null)},t.prototype.onGitOperation=function(){this.gitService.getRunningOperations().length>0?this.disableUI():this.enableUI()},t.prototype.dispose=function(){this.$el&&(this.$el.dispose(),this.$el=null),this.disposeTFSSection(),this.toDispose=o.disposeAll(this.toDispose),e.prototype.dispose.call(this)},t.EMPTY_MESSAGE=n.localize("vs_workbench_contrib_git_views_empty_emptyView",10),t}(s.EventEmitter);t.EmptyView=S}),define("vs/css!vs/workbench/contrib/git/views/gitless/gitlessView",["vs/css!vs/workbench/contrib/git/gitViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/views/gitless/gitlessView",["require","exports","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/base/env","vs/platform/services","vs/base/lib/winjs.base","vs/base/eventEmitter","vs/base/dom/builder","vs/css!./gitlessView"],function(e,t,n,r,i,o,s,a){var l=a.$,c=function(e){function t(){e.apply(this,arguments),this.ID="gitless"}return __extends(t,e),Object.defineProperty(t.prototype,"element",{get:function(){return this._element||this.render(),this._element},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e;e=r.isMacintosh?n.localize("vs_workbench_contrib_git_views_gitless_gitlessView",0,'<a href="http://brew.sh/" target="_blank">Homebrew</a>','<a href="http://git-scm.com/download/mac" target="_blank">git-scm.com</a>','<a href="https://developer.apple.com/xcode/" target="_blank">XCode</a>',"<code>git</code>"):r.isWindows?n.localize("vs_workbench_contrib_git_views_gitless_gitlessView",1,'<a href="https://chocolatey.org/packages/git" target="_blank">Chocolatey</a>','<a href="http://git-scm.com/download/win" target="_blank">git-scm.com</a>'):r.isLinux?n.localize("vs_workbench_contrib_git_views_gitless_gitlessView",2,'<a href="http://git-scm.com/download/linux" target="_blank">git-scm.com</a>'):n.localize("vs_workbench_contrib_git_views_gitless_gitlessView",3,'<a href="http://git-scm.com/download" target="_blank">git-scm.com</a>'),this._element=l(['<div class="gitless-view">',"<p>",n.localize("vs_workbench_contrib_git_views_gitless_gitlessView",4),"</p>","<p>",e,"</p>","<p>",n.localize("vs_workbench_contrib_git_views_gitless_gitlessView",5,r.applicationName),"</p>","</div>"].join("")).getHTMLElement()},t.prototype.focus=function(){},t.prototype.layout=function(){},t.prototype.setVisible=function(){return o.Promise.as(null)},t.prototype.getSelection=function(){return i.Selection.EMPTY},t.prototype.getControl=function(){return null},t.prototype.getActions=function(){return[]},t.prototype.getSecondaryActions=function(){return[]},t}(s.EventEmitter);t.GitlessView=c}),define("vs/css!vs/workbench/contrib/git/views/notroot/notrootView",["vs/css!vs/workbench/contrib/git/gitViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/views/notroot/notrootView",["require","exports","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/platform/services","vs/base/lib/winjs.base","vs/base/eventEmitter","vs/base/dom/builder","vs/css!./notrootView"],function(e,t,n,r,i,o,s){var a=s.$,l=function(e){function t(){e.apply(this,arguments),this.ID="notroot"}return __extends(t,e),Object.defineProperty(t.prototype,"element",{get:function(){return this._element||this.render(),this._element},enumerable:!0,configurable:!0}),t.prototype.render=function(){this._element=a(['<div class="notroot-view">',"<p>",n.localize("vs_workbench_contrib_git_views_notroot_notrootView",0),"</p>","<p>",n.localize("vs_workbench_contrib_git_views_notroot_notrootView",1),"</p>","</div>"].join("")).getHTMLElement()},t.prototype.focus=function(){},t.prototype.layout=function(){},t.prototype.setVisible=function(){return i.Promise.as(null)},t.prototype.getSelection=function(){return r.Selection.EMPTY},t.prototype.getControl=function(){return null},t.prototype.getActions=function(){return[]},t.prototype.getSecondaryActions=function(){return[]},t}(o.EventEmitter);t.NotRootView=l}),define("vs/css!vs/workbench/contrib/git/views/noworkspace/noworkspaceView",["vs/css!vs/workbench/contrib/git/gitViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/views/noworkspace/noworkspaceView",["require","exports","vs/nls!vs/workbench/contrib/git/gitViewlet","vs/platform/services","vs/base/lib/winjs.base","vs/base/eventEmitter","vs/base/dom/builder","vs/css!./noworkspaceView"],function(e,t,n,r,i,o,s){var a=s.$,l=function(e){function t(){e.apply(this,arguments),this.ID="noworkspace"}return __extends(t,e),Object.defineProperty(t.prototype,"element",{get:function(){return this._element||this.render(),this._element},enumerable:!0,configurable:!0}),t.prototype.render=function(){this._element=a(['<div class="noworkspace-view">',"<p>",n.localize("vs_workbench_contrib_git_views_noworkspace_noworkspaceView",0),"</p>","<p>",n.localize("vs_workbench_contrib_git_views_noworkspace_noworkspaceView",1),"</p>","</div>"].join("")).getHTMLElement()},t.prototype.focus=function(){},t.prototype.layout=function(){},t.prototype.setVisible=function(){return i.Promise.as(null)},t.prototype.getSelection=function(){return r.Selection.EMPTY},t.prototype.getControl=function(){return null},t.prototype.getActions=function(){return[]},t.prototype.getSecondaryActions=function(){return[]},t}(o.EventEmitter);t.NoWorkspaceView=l}),define("vs/css!vs/workbench/contrib/git/media/gitViewlet",["vs/css!vs/workbench/contrib/git/gitViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/git/gitViewlet",["require","exports","vs/base/lib/winjs.base","vs/platform/services","vs/base/lifecycle","vs/workbench/ui/parts/viewlet","vs/workbench/contrib/git/git","vs/workbench/contrib/git/git.contribution","vs/workbench/contrib/git/views/changes/changesView","vs/workbench/contrib/git/views/empty/emptyView","vs/workbench/contrib/git/views/gitless/gitlessView","vs/workbench/contrib/git/views/notroot/notrootView","vs/workbench/contrib/git/views/noworkspace/noworkspaceView","vs/css!./media/gitViewlet"],function(e,t,n,r,i,o,s,a,l,c,u,d,p){var h=function(e){function t(t){var n=this;e.call(this,t,a.VIEWLET_ID),this.progressService=t.progressService,this.instantiationService=t.instantiationService,this.gitService=t.gitService,this.progressRunner=null,this.views={},this.toDispose=[];var r=[this.instantiationService.createInstance(l.ChangesView,this.getActionRunner()),this.instantiationService.createInstance(c.EmptyView,this,this.getActionRunner()),new u.GitlessView,new d.NotRootView,new p.NoWorkspaceView];r.forEach(function(e){n.views[e.ID]=e,n.toDispose.push(e)}),this.toUnbind.push(this.gitService.addBulkListener(function(){return n.onGitServiceChanges()}))}return __extends(t,e),t.prototype.setView=function(e){if(!this.$el)return n.Promise.as(null);var t=this.views[e];if(!t)return n.Promise.wrapError(new Error("Could not find view."));if(this.currentView===t)return n.Promise.as(null);var r=n.Promise.as(null);this.currentView&&(r=this.currentView.setVisible(!1));var i=t.element;this.currentView=t,this.updateTitleArea();for(var o=this.$el.getHTMLElement();o.firstChild;)o.removeChild(o.firstChild);return o.appendChild(i),t.layout(this.currentDimension),r.then(function(){return t.setVisible(!0)})},t.prototype.create=function(t){return e.prototype.create.call(this,t),this.$el=t.div().addClass("git-viewlet"),n.Promise.as(null)},t.prototype.setVisible=function(t){var r=this;return t?(this.onGitServiceChanges(),this.gitService.status().done(),e.prototype.setVisible.call(this,t).then(function(){return r.currentView?r.currentView.setVisible(t):void 0})):(this.currentView?this.currentView.setVisible(t):n.Promise.as(null)).then(function(){e.prototype.setVisible.call(r,t)})},t.prototype.focus=function(){e.prototype.focus.call(this),this.currentView&&this.currentView.focus()},t.prototype.layout=function(t){void 0===t&&(t=this.currentDimension),e.prototype.layout.call(this,t),this.currentDimension=t,this.currentView&&this.currentView.layout(t)},t.prototype.getActions=function(){return this.currentView?this.currentView.getActions():[]},t.prototype.getSecondaryActions=function(){return this.currentView?this.currentView.getSecondaryActions():[]},t.prototype.getSelection=function(){return this.currentView?this.currentView.getSelection():r.Selection.EMPTY},t.prototype.getControl=function(){return this.currentView?this.currentView.getControl():null},t.prototype.onGitServiceChanges=function(){this.progressRunner&&this.progressRunner.done(),this.gitService.getState()===s.ServiceState.NoGit?(this.setView("gitless"),this.progressRunner=null):this.gitService.getState()===s.ServiceState.NotARepo?(this.setView("empty"),this.progressRunner=null):this.gitService.getState()===s.ServiceState.NotAWorkspace?(this.setView("noworkspace"),this.progressRunner=null):this.gitService.getState()===s.ServiceState.NotAtRepoRoot?(this.setView("notroot"),this.progressRunner=null):this.gitService.isIdle()?(this.setView("changes"),this.progressRunner=null):this.progressRunner=this.progressService.show(!0)},t.prototype.dispose=function(){this.toDispose=i.disposeAll(this.toDispose),this.views=null,e.prototype.dispose.call(this)},t}(o.Viewlet);t.GitViewlet=h});