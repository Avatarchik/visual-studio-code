/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/debug/debugViewer",["require","exports","vs/base/lib/winjs.base","vs/base/lifecycle","vs/base/paths","vs/base/strings","vs/base/dom/dom","vs/base/ui/labels","vs/base/ui/widgets/actionbar","vs/base/ui/widgets/tree/treeDefaults","vs/base/ui/widgets/tree/actionsRenderer","vs/workbench/contrib/debug/debugModel","vs/workbench/contrib/debug/debugViewModel","vs/workbench/contrib/debug/debugActions"],function(e,t,n,r,i,o,s,a,l,c,u,d,p,h){function m(e,t,n){var r=e.getElementsByClassName(n);if(r.length>0)return r.item(0);var i=document.createElement(t);return n&&s.addClass(i,n),e.appendChild(i),i}t.getOrCreateChild=m;var f=function(e){function t(t,n,r){e.call(this,{actionProvider:n,actionRunner:r}),this.pathLabelProvider=new a.PathLabelProvider(t)}return __extends(t,e),t.prototype.getHeight=function(){return t.ELEMENT_HEIGHT},t.ELEMENT_HEIGHT=24,t}(u.ActionsRenderer);t.AbstractRenderer=f;var g=function(){function e(){}return e.prototype.hasActions=function(){return!1},e.prototype.getActions=function(){var e=[];return n.Promise.as(e)},e.prototype.hasSecondaryActions=function(){return!1},e.prototype.getSecondaryActions=function(){var e=[];return n.Promise.as(e)},e.prototype.getActionItem=function(){return null},e}();t.SimpleActionProvider=g;var v=function(){function e(){}return e.prototype.getId=function(e,t){return t.getId()},e.prototype.hasChildren=function(e,t){return t instanceof d.Model||t instanceof d.Thread},e.prototype.getChildren=function(e,t){if(t instanceof d.Thread)return n.Promise.as(t.callStack);var r=t.getThreads(),i=[];for(var o in r)r.hasOwnProperty(o)&&i.push(r[o]);return 1===i.length?n.Promise.as(i[0].callStack):n.Promise.as(i)},e.prototype.getParent=function(){return n.Promise.as(null)},e}();t.CallStackDataSource=v;var b=function(e){function t(t,n,r){e.call(this,t,n,r)}return __extends(t,e),t.prototype.renderContents=function(e,t,n){if(t instanceof d.Thread){var r=t,o=m(n,"div","thread");o.textContent=r.name}else{var s=m(n,"div","stack-frame"),a=m(s,"span","label"),l=m(s,"div","file"),c=m(l,"span","file-name"),u=m(l,"span","line-number"),p=t;l.title=p.source.uri.path,a.textContent=p.name,c.textContent=p.source.isInMemory()?p.source.name:this.pathLabelProvider.getLabel(i.basename(p.source.uri.path)),u.textContent=""+p.lineNumber}return null},t}(f);t.CallStackRenderer=b;var y=function(){function e(e){this.debugService=e}return e.prototype.getId=function(e,t){return t.getId()},e.prototype.hasChildren=function(e,t){if(t instanceof p.ViewModel||t instanceof d.Scope)return!0;if(t instanceof d.Variable){var n=t;return 0!==n.reference&&!o.equalsIgnoreCase(n.value,"null")}return!1},e.prototype.getChildren=function(e,t){if(t instanceof p.ViewModel){var r=t.getFocusedStackFrame();if(r)return n.Promise.as(r.scopes)}else if(t instanceof d.Scope){var i=t;if(i.reference>0)return i.getVariables(this.debugService)}else if(t instanceof d.Variable){var o=t;if(o.reference>0)return o.getVariables(this.debugService)}return n.Promise.as([])},e.prototype.getParent=function(){return n.Promise.as(null)},e}();t.VariablesDataSource=y;var _=function(e){function t(t,n,r){e.call(this,t,n,r)}return __extends(t,e),t.prototype.renderContents=function(e,n,r){return n instanceof d.Scope?t.renderScope(n,r):t.renderVariable(n,r)},t.renderScope=function(e,t){var n=m(t,"div","scope");return n.textContent=e.name,null},t.renderVariable=function(e,n){var r=m(n,"div","variable"),i=m(r,"span","name"),o=m(r,"span","value");return e.value&&(isNaN(+e.value)?t.BOOLEAN_REGEX.test(e.value)?s.addClass(o,"boolean"):t.STRING_REGEX.test(e.value)&&s.addClass(o,"string"):s.addClass(o,"number")),i.textContent=e.name,o.textContent=e.getReadableValue(),o.title=e.getReadableValue(),null},t.BOOLEAN_REGEX=/^true|false$/i,t.STRING_REGEX=/^(['"]).*\1$/,t}(f);t.VariablesRenderer=_;var w=function(e){function t(t){e.call(this),this.instantiationService=t}return __extends(t,e),t.prototype.hasActions=function(e,t){return t instanceof d.Breakpoint},t.prototype.hasSecondaryActions=function(e,t){return t instanceof d.Breakpoint||t instanceof d.ExceptionBreakpoint},t.prototype.getActions=function(e,t){return t instanceof d.Breakpoint?n.Promise.as([this.instantiationService.createInstance(h.RemoveBreakpointAction,t)]):n.Promise.as([])},t.prototype.getSecondaryActions=function(e,t){var r=[this.instantiationService.createInstance(h.ToggleEnablementAction,t)];return t instanceof d.Breakpoint&&(r.push(new l.Separator),r.push(this.instantiationService.createInstance(h.RemoveBreakpointAction,t)),r.push(this.instantiationService.createInstance(h.RemoveAllBreakpointsAction)),r.push(new l.Separator),r.push(this.instantiationService.createInstance(h.EnableAllBreakpointsAction)),r.push(this.instantiationService.createInstance(h.DisableAllBreakpointsActions))),n.Promise.as(r)},t}(g);t.BreakpointsActionProvider=w;var S=function(){function e(){}return e.prototype.getId=function(e,t){return t.getId()},e.prototype.hasChildren=function(e,t){return t instanceof d.Model},e.prototype.getChildren=function(e,t){var r=t,i=r.getExceptionBreakpoints();return n.Promise.as(i.concat(r.getBreakpoints()))},e.prototype.getParent=function(){return n.Promise.as(null)},e}();t.BreakpointsDataSource=S;var E=function(e){function t(t,n,r,i){e.call(this,n,r,i),this.debugService=t,this.toDispose=[]}return __extends(t,e),t.prototype.renderContents=function(e,t,n){var r=m(n,"div","breakpoint");r.appendChild(this.createCheckbox(t));var s=m(r,"span","name");if(t instanceof d.Breakpoint){var a=t,l=m(r,"span","line-number"),c=m(r,"span","file-path"),u=this.pathLabelProvider.getLabel(a.source.uri.path);s.textContent=i.basename(u),l.textContent=""+a.lineNumber,c.textContent=i.dirname(u)}else{var p=t,h=p.name.charAt(0).toUpperCase()+p.name.slice(1);s.textContent=o.format("{0} exceptions",h)}return null},t.prototype.createCheckbox=function(e){var t=this,n=document.createElement("input");return n.type="checkbox",n.className="checkbox",n.checked=e.enabled,this.toDispose.push(s.addStandardDisposableListener(n,"change",function(){t.debugService.getModel().toggleEnablement(e)})),n},t.prototype.dispose=function(){this.debugService=null,this.toDispose=r.disposeAll(this.toDispose),e.prototype.dispose.call(this)},t}(f);t.BreakpointsRenderer=E;var T=function(e){function t(t,n,r){e.call(this),this.contextMenuService=t,this.debugService=n,this.actionProvider=r}return __extends(t,e),t.prototype.onContextMenu=function(e,t,n){var r=this;if(n.target&&n.target.tagName&&"input"===n.target.tagName.toLowerCase())return!1;if(n.preventDefault(),n.stopPropagation(),e.setFocus(t),this.actionProvider.hasSecondaryActions(e,t)){var i={x:n.posx+1,y:n.posy};return this.contextMenuService.showContextMenu({getAnchor:function(){return i},getActions:function(){return r.actionProvider.getSecondaryActions(e,t)},onHide:function(t){t&&e.DOMFocus()}}),!0}return!1},t}(c.DefaultController);t.BreakpointsController=T});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/debug/debugActionItems",["require","exports","vs/base/lifecycle","vs/base/dom/dom","vs/base/ui/widgets/actionbar","vs/platform/services","vs/workbench/contrib/debug/debug"],function(e,t,n,r,i,o,s){var a=function(e){function t(t,n){e.call(this,t,n),this.debugService=t.debugService,this.configurationService=t.configurationService,this.select=document.createElement("select"),this.select.className="debug-select action-bar-select",this.toDispose=[],this.registerListeners()}return __extends(t,e),t.prototype.registerListeners=function(){var e=this;this.toDispose.push(r.addStandardDisposableListener(this.select,"change",function(t){e.actionRunner.run(e._action,t.target.value).done()})),this.toDispose.push(this.debugService.addListener2(s.ServiceEvents.STATE_CHANGED,function(){e.select.disabled=e.debugService.getState()!==s.State.Inactive})),this.toDispose.push(this.configurationService.addListener2(o.ConfigurationServiceEventTypes.UPDATED,function(){e.setOptions().done()}))},t.prototype.render=function(e){r.addClass(e,"select-container"),e.appendChild(this.select),this.setOptions().done()},t.prototype.setOptions=function(){var e=this,t=this.select.selectedIndex;return this.select.options.length=0,this.configurationService.loadConfiguration("launch").then(function(n){if(!n||!n.configurations)return e.select.options.add(e.createOption("<none>")),e.select.disabled=!0,void 0;var r=n.configurations;e.select.disabled=r.length<1;for(var i=!1,o=0;o<r.length;o++)e.select.options.add(e.createOption(r[o].name)),r[o].name===e.debugService.selectedConfigName&&(e.select.selectedIndex=o,i=!0);return!i&&r.length>0?((!t||0>t||t>=r.length)&&(t=0),e.select.selectedIndex=t,e.actionRunner.run(e._action,r[t].name)):void 0})},t.prototype.createOption=function(e){var t=document.createElement("option");return t.value=e,t.text=e,t},t.prototype.dispose=function(){this.debugService=null,this.configurationService=null,this.toDispose=n.disposeAll(this.toDispose),e.prototype.dispose.call(this)},t}(i.BaseActionItem);t.SelectConfigActionItem=a}),define("vs/css!vs/workbench/contrib/debug/media/debugViewlet",["vs/css!vs/workbench/contrib/debug/debugViewlet"],{});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};define("vs/workbench/contrib/debug/debugViewlet",["require","exports","vs/nls!vs/workbench/contrib/debug/debugViewlet","vs/base/dom/dom","vs/base/dom/builder","vs/base/lib/winjs.base","vs/base/lifecycle","vs/base/ui/widgets/tree/treeImpl","vs/base/ui/widgets/splitview","vs/workbench/ui/parts/viewlet","vs/workbench/contrib/debug/debug","vs/workbench/contrib/debug/debugModel","vs/workbench/contrib/debug/debugViewer","vs/workbench/contrib/debug/debugActions","vs/workbench/contrib/debug/debugActionItems","vs/css!./media/debugViewlet"],function(e,t,n,r,i,o,s,a,l,c,u,d,p,h,m){function f(e){var t=document.createElement("div");return r.addClass(t,"debug-view-content"),e.appendChild(t),t}var g={indentPixels:8,twistiePixels:20},v=function(e){function t(t,n){e.call(this,t,n,"variablesView"),this.debugService=t.debugService,this.contextService=t.contextService,this.instantiationService=t.instantiationService}return __extends(t,e),t.prototype.renderHeader=function(t){e.prototype.renderHeader.call(this,t);var r=y("div.title").appendTo(t);y("span").text(n.localize("vs_workbench_contrib_debug_debugViewlet",0)).appendTo(r)},t.prototype.renderBody=function(e){var t=this;this.treeContainer=f(e),r.addClass(this.treeContainer,"debug-variables"),this.tree=new a.Tree(this.treeContainer,{dataSource:new p.VariablesDataSource(this.debugService),renderer:new p.VariablesRenderer(this.contextService,new p.SimpleActionProvider,this.actionRunner)},g);var n=this.debugService.getViewModel();this.tree.setInput(n),this.toDispose.push(n.addListener2(u.ViewModelEvents.FOCUSED_STACK_FRAME_UPDATED,function(){return t.onFocusedStackFrameUpdated()}))},t.prototype.onFocusedStackFrameUpdated=function(){var e=this;this.tree.refresh().done(function(){var t=e.debugService.getViewModel().getFocusedStackFrame();return t&&t.scopes.length>0?e.tree.expand(t.scopes[0]):void 0})},t}(c.CollapsibleViewletView),b=function(e){function t(t,n){e.call(this,t,n,"callStackView"),this.debugService=t.debugService,this.contextService=t.contextService}return __extends(t,e),t.prototype.renderHeader=function(t){e.prototype.renderHeader.call(this,t);var r=y("div.title").appendTo(t);y("span").text(n.localize("vs_workbench_contrib_debug_debugViewlet",1)).appendTo(r)},t.prototype.renderBody=function(e){var t=this;this.renderExceptionBox(e),this.treeContainer=f(e),r.addClass(this.treeContainer,"debug-call-stack"),this.tree=new a.Tree(this.treeContainer,{dataSource:new p.CallStackDataSource,renderer:new p.CallStackRenderer(this.contextService,new p.SimpleActionProvider,this.actionRunner)},g);var i=this.debugService.getModel();this.tree.setInput(i),this.toDispose.push(this.tree.addListener2("selection",function(e){if(e.selection.length){var n=e.selection[0];if(n instanceof d.StackFrame){var r=n;t.debugService.getViewModel().setFocusedStackFrame(r);var i="mouse"===e.payload.origin,o=e&&e.payload&&e.payload.originalEvent&&(e.payload.originalEvent.ctrlKey||e.payload.originalEvent.metaKey);t.debugService.openOrRevealEditor(r.source,r.lineNumber,i,o)}}})),this.toDispose.push(i.addListener2(u.ModelEvents.THREADS_UPDATED,function(){t.tree.refresh();var e=t.debugService.getModel().getThreads();for(var r in e)if(e.hasOwnProperty(r)&&e[r].exception)return t.exceptionBox.textContent=n.localize("vs_workbench_contrib_debug_debugViewlet",2)+e[r].exception.message,t.exceptionBox.hidden=!1,void 0;t.exceptionBox.hidden=!0})),this.toDispose.push(this.debugService.getViewModel().addListener2(u.ViewModelEvents.FOCUSED_STACK_FRAME_UPDATED,function(){var e=t.debugService.getViewModel().getFocusedStackFrame();if(e){var n=t.debugService.getModel().getThreads();for(var r in n)n[r].callStack.some(function(t){return t===e})&&t.tree.expand(n[r]);t.tree.setFocus(e)}}))},t.prototype.renderExceptionBox=function(e){this.exceptionBox=document.createElement("div"),r.addClass(this.exceptionBox,"debug-exception-box"),this.exceptionBox.hidden=!0,e.appendChild(this.exceptionBox)},t}(c.CollapsibleViewletView),y=i.$,_=function(e){function t(n,r){var i=this,o=n.debugService.getModel().getBreakpoints().length+n.debugService.getModel().getExceptionBreakpoints().length;e.call(this,n,r,t.getExpandedBodySize(o),!1,"breakpointsView"),this.debugService=n.debugService,this.contextService=n.contextService,this.instantiationService=n.instantiationService,this.actionProvider=new p.BreakpointsActionProvider(this.instantiationService),this.toDispose.push(this.debugService.getModel().addListener2(u.ModelEvents.BREAKPOINTS_UPDATED,function(){return i.onBreakpointsChange()})),this.toDispose.push(this.debugService.getModel().addListener2(u.ModelEvents.EXCEPTION_BREAKPOINT_UPDATED,function(){return i.onBreakpointsChange()}))}return __extends(t,e),t.prototype.renderHeader=function(t){e.prototype.renderHeader.call(this,t);var r=y("div.title").appendTo(t);y("span").text(n.localize("vs_workbench_contrib_debug_debugViewlet",3)).appendTo(r)},t.prototype.renderBody=function(e){var t=this;this.treeContainer=f(e),r.addClass(this.treeContainer,"debug-breakpoints"),this.tree=new a.Tree(this.treeContainer,{dataSource:new p.BreakpointsDataSource,renderer:new p.BreakpointsRenderer(this.debugService,this.contextService,this.actionProvider,this.actionRunner),controller:new p.BreakpointsController(this.contextMenuService,this.debugService,this.actionProvider),sorter:{compare:function(e,t,n){var r=t,i=n;return r instanceof d.ExceptionBreakpoint?-1:i instanceof d.ExceptionBreakpoint?1:r.source.uri.toString()!==i.source.uri.toString()?r.source.uri.toString().localeCompare(i.source.uri.toString()):r.lineNumber-i.lineNumber}}},g);var n=this.debugService.getModel();this.tree.setInput(n),this.toDispose.push(this.tree.addListener2("selection",function(e){if(e.selection.length){var n=e.selection[0];if(n instanceof d.Breakpoint){var r=n;if(!r.source.isInMemory()){var i="mouse"===e.payload.origin,o=e&&e.payload&&e.payload.originalEvent&&(e.payload.originalEvent.ctrlKey||e.payload.originalEvent.metaKey);t.debugService.openOrRevealEditor(r.source,r.lineNumber,i,o)}}}})),this.tree.refresh()},t.prototype.getActions=function(){return[this.instantiationService.createInstance(h.RemoveAllBreakpointsAction)]},t.prototype.onBreakpointsChange=function(){this.expandedBodySize=t.getExpandedBodySize(this.debugService.getModel().getBreakpoints().length+this.debugService.getModel().getExceptionBreakpoints().length),this.tree&&this.tree.refresh()},t.getExpandedBodySize=function(e){return Math.min(t.MAX_VISIBLE_FILES,e)*p.AbstractRenderer.ELEMENT_HEIGHT},t.MAX_VISIBLE_FILES=9,t}(c.AdaptiveCollapsibleViewletView),w=function(e){function t(t){var n=this;e.call(this,t,u.VIEWLET_ID),this.progressService=t.progressService,this.debugService=t.debugService,this.instantiationService=t.instantiationService,this.contextService=t.contextService,this.progressRunner=null,this.toDispose=[],this.toDispose.push(this.debugService.addListener2(u.ServiceEvents.STATE_CHANGED,function(){n.onDebugServiceStateChange()}))}return __extends(t,e),t.prototype.create=function(t){if(e.prototype.create.call(this,t),this.$el=t.div().addClass("debug-viewlet"),null===this.contextService.getWorkspace()){var r=y(['<div class="noworkspace-view">',"<p>",n.localize("vs_workbench_contrib_debug_debugViewlet",4),"</p>","<p>",n.localize("vs_workbench_contrib_debug_debugViewlet",5),"</p>","</div>"].join("")).getHTMLElement();this.$el.getHTMLElement().appendChild(r)}else{this.splitView=new l.SplitView(this.$el.getHTMLElement());var i=this.getActionRunner();this.splitView.addView(this.instantiationService.createInstance(v,i)),this.splitView.addView(this.instantiationService.createInstance(b,i)),this.splitView.addView(this.instantiationService.createInstance(_,i))}return o.Promise.as(null)},t.prototype.layout=function(t){e.prototype.layout.call(this,t),this.splitView&&this.splitView.layout(t.height)},t.prototype.getActions=function(){var e=this;return this.actions||(this.actions=null===this.contextService.getWorkspace()?[]:[this.instantiationService.createInstance(h.StartDebugAction),this.instantiationService.createInstance(h.SelectConfigAction),this.instantiationService.createInstance(h.ConfigureAction)],this.actions.forEach(function(t){e.toDispose.push(t)})),this.actions},t.prototype.getActionItem=function(e){return e.id===h.SelectConfigAction.ID?this.instantiationService.createInstance(m.SelectConfigActionItem,e):null},t.prototype.getSecondaryActions=function(){return[]},t.prototype.onDebugServiceStateChange=function(){this.progressRunner&&this.progressRunner.done(),this.progressRunner=this.debugService.getState()===u.State.Initializing?this.progressService.show(!0):null},t.prototype.dispose=function(){this.toDispose=s.disposeAll(this.toDispose),e.prototype.dispose.call(this)},t}(c.Viewlet);t.DebugViewlet=w});